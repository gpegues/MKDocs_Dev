<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <title>PowerShell Profile | Managed Services KB</title>

    
    

    
    
    <link href="../../assets/css/main.css" rel="stylesheet">
    
    <link href="../../assets/css/custom.css" rel="stylesheet">
    
    <link href="../../assets/css/print.css" rel="stylesheet">
    

    
    
    

    
    <script type="text/javascript">
        /* eslint-disable */
        // prettier-ignore
        var base_url = "../..";
        /* eslint-enable */
    </script>

<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
        </style></head>
<body class="theme-blackout"> 

    
    <header class="bo-header">
    <div class="bo-container bo-header-grid">

        
        <button class="bo-sidebar-toggle" id="bo-sidebar-toggle" aria-label="Toggle Navigation">
            <span class="bo-icon-menu"></span> 
        </button>

        
        <div class="bo-header-title">
            <a href="../.." title="Managed Services KB">
                
                
                Managed Services KB
            </a>
        </div>

        
        

        
        
        <div class="bo-header-search">
            
            <button class="bo-search-toggle" data-search-toggle title="Search (Ctrl+K)">
                <span class="bo-search-icon"></span> 
                <span class="bo-search-text">Search</span>
                <span class="bo-search-shortcut">Ctrl K</span>
            </button>
        </div>
        

        
        
        <div class="bo-header-repo">
            <a href="https://github.com/rivcoit/MKDocs" target="_blank" rel="noopener" title="View on GitHub" aria-label="View repository on GitHub">
                <svg viewBox="0 0 16 16" width="20" height="20" aria-hidden="true">
                    <path fill="currentColor" d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
                </svg>
            </a>
        </div>
        

    </div>
</header>

    
    <div class="bo-container">
        <div class="bo-main-grid">

            
            <aside class="bo-sidebar bo-sidebar-left">
                



<nav class="bo-nav-main">
  <ul class="bo-nav-list">
    
      
<li class="bo-nav-item  ">
  
    <a href="../.." class="bo-nav-link">
      Managed Services
    </a>
  
</li>

    
      
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Enterprise Notifications
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../EnterpriseNotifications/Export%20a%20wiki%20to%20a%20OneNote%20notebook%20in%20Microsoft%20Teams/" class="bo-nav-link">
      Export a Wiki to OneNote
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../EnterpriseNotifications/Important%20Update%20Changes%20to%20Note-Taking%20%28Wiki%29%20in%20Microsoft%20Teams/" class="bo-nav-link">
      Wiki Changes
    </a>
  
</li>
 
      
    </ul>
  
</li>

    
      
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Exchange
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/" class="bo-nav-link">
      General Information
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      eDiscovery
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/eDiscoveryLitigation/" class="bo-nav-link">
      eDiscovery Litigation
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/mailremovaldefender/" class="bo-nav-link">
      Email Removal Requests
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Mailboxes
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/RemoteEnableUser/" class="bo-nav-link">
      Creating User Email
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/MessageTrace/" class="bo-nav-link">
      Message Trace
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/scan2email/" class="bo-nav-link">
      SMTP to SharedMailbox
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Misc.
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      3rd Party
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/3rdParty/TangoReserve/TRSetupChecklist/" class="bo-nav-link">
      TangoReserve
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/Help%20Desk%20Support%20for%20Outlook/" class="bo-nav-link">
      Help Desk Support
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/NextRequest-PublicRecordsRequests/" class="bo-nav-link">
      Next Request - PRAs
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/Role%20Clarification%20for%20M365%20Services%20and%20Help%20Desk/" class="bo-nav-link">
      Role Clarification
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Server
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/Server%202016/Create%20New%20Edge%20Subscription/" class="bo-nav-link">
      Edge Subscription
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/Exchange%202016%20server%20%28Non-DAG%20Setup%29%20maintenance%20mode/" class="bo-nav-link">
      Maintenance Mode
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      User Documentation
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/UserDocumentation/M365-ExchangeOnline-UserCalendarManagement/" class="bo-nav-link">
      Calendar Management
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/UserDocumentation/M365-ExchangeOnline%20Distribution%20Group%20Management%20%28EndUser%29/" class="bo-nav-link">
      Distribution Group Management
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/UserDocumentation/M365-ExchangeOnline%20Distribution%20Group%20Types/" class="bo-nav-link">
      Distribution Group Types
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/UserDocumentation/M365-ExchangeOnline%20ServiceNow%20Request%20Submission%20Guidelines%20for%20Microsoft%20365%20Exchange%20Online%20Resource%20Access/" class="bo-nav-link">
      ServiceNow Request Guidelines
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Exchange/UserDocumentation/M365-ExchangeOnline%20Autoreply%20for%20Shared%20Mailboxes/" class="bo-nav-link">
      Updating Auto-Reply
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>

    
      
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      GitHub
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Actions
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../GitHub/ActionsAutomations/" class="bo-nav-link">
      Automations
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../GitHub/Onboarding/" class="bo-nav-link">
      Onboarding
    </a>
  
</li>
 
      
    </ul>
  
</li>

    
      
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      M365
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/" class="bo-nav-link">
      General Information
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/Framework-BotApproval-M365/" class="bo-nav-link">
      Bots
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/Bookings/BookingsGovernance/" class="bo-nav-link">
      Bookings
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Licensing
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/Licensing/" class="bo-nav-link">
      General Information
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/LicenseGroups/" class="bo-nav-link">
      Licensing Groups
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Misc
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/CalendarOptionsinM365/" class="bo-nav-link">
      Calendar Options
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Power BI
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/PowerBI/PublishtoWebGuidelines/" class="bo-nav-link">
      Publish to Web
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Data Gateway Cluster Server Management
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/PowerBI/datagateways/patching-clustered-gateways/" class="bo-nav-link">
      Updating the Data Gateway Cluster
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../M365/PowerBI/datagateways/gateway-additional-applications/" class="bo-nav-link">
      Additional Applications
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>

    
      
<li class="bo-nav-item is-active has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Misc
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../Syncs/" class="bo-nav-link">
      Syncs
    </a>
  
</li>
 
      
        
<li class="bo-nav-item is-active ">
  
    <a href="./" class="bo-nav-link">
      PowerShell Profile
    </a>
  
</li>
 
      
    </ul>
  
</li>

    
      
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Teams
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Teams/" class="bo-nav-link">
      General Information
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Teams/DeviceProvisioning/" class="bo-nav-link">
      Device Provisioning
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Teams/DeviceManagement/" class="bo-nav-link">
      Device Management
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Policies
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Teams/Policies/Recording/" class="bo-nav-link">
      Recording
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Troubleshooting
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../Teams/Troubleshooting/UnblockUser/" class="bo-nav-link">
      Unblock Users
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>

    
      
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Web Server Support
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/" class="bo-nav-link">
      General
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      FTP
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/FTP/general/" class="bo-nav-link">
      GENERAL
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      CERBERUS
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/FTP/docs/Cerberus-ApplicationUpdate/" class="bo-nav-link">
      Application Update
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/FTP/docs/Cerberus-FTPGroupCreation/" class="bo-nav-link">
      FTP Group Creation
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      Servers
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      IIS
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      RIVCO
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/RIVCOCA/RCIT-16WEB01/" class="bo-nav-link">
      RCIT-16WEB01
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/RIVCOCA/RCIT-16WEB01T/" class="bo-nav-link">
      RCIT-16WEB01T
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
        
<li class="bo-nav-item  has-children">
  
    <a href="javascript:void(0);" class="bo-nav-link">
      TZONE
    </a>
    <ul class="bo-nav-list is-child-list">
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/TZONE/TZVM101/" class="bo-nav-link">
      TZVM101
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/TZONE/TZVM102/" class="bo-nav-link">
      TZVM102
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/TZONE/TZVM103/" class="bo-nav-link">
      TZVM103
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/TZONE/TZVM104/" class="bo-nav-link">
      TZVM104
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/TZONE/TZVM105/" class="bo-nav-link">
      TZVM105
    </a>
  
</li>
 
      
        
<li class="bo-nav-item  ">
  
    <a href="../../WebServerSupport/IIS/TZONE/TZVM106/" class="bo-nav-link">
      TZVM106
    </a>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>
 
      
    </ul>
  
</li>

    
  </ul>
</nav>
            </aside>

            
            <main class="bo-content">
                
                
                <div class="bo-page-meta-top">
                    
                    
                    <nav class="bo-breadcrumbs" aria-label="Breadcrumb">
                        <a href="../..">Home</a>
                        
                            <span class="bo-breadcrumb-separator">/</span>
                            <a href="../..">Misc</a>
                        
                        <span class="bo-breadcrumb-separator">/</span>
                        <span class="bo-breadcrumb-current">PowerShell Profile</span>
                    </nav>
                    
                </div>
                
                
                <article class="bo-article">
                    
                        <h1 id="powershell-profile-m365-admin-tools">PowerShell Profile - M365 Admin Tools<a class="headerlink" href="#powershell-profile-m365-admin-tools" title="Permanent link">¶</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p>This PowerShell profile automatically loads M365 administration tools and shortcuts when PowerShell starts. It provides quick connection commands, useful functions, and aliases for common Exchange Online, SharePoint, Microsoft Graph, and Teams tasks.</p>
<p>The profile includes pre-built functions for:
- Connecting to M365 services (Exchange, Graph, SPO, Teams, SCC, Azure)
- Email and mailbox management
- Group management and membership checking
- Audit and troubleshooting capabilities
- Calendar loop detection and remediation
- Mobile device management
- Temporary mailbox access control</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">¶</a></h2>
<h3 id="step-1-locate-your-profile">Step 1: Locate Your Profile<a class="headerlink" href="#step-1-locate-your-profile" title="Permanent link">¶</a></h3>
<p>Open PowerShell and check your profile location:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nv">$PROFILE</span>
</span></code></pre></div>
<p>This will return something like: <code>C:\Users\&lt;username&gt;\Documents\PowerShell\profile.ps1</code></p>
<h3 id="step-2-create-profile-if-it-doesnt-exist">Step 2: Create Profile (if it doesn't exist)<a class="headerlink" href="#step-2-create-profile-if-it-doesnt-exist" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">New-Item</span> <span class="n">-ItemType</span> <span class="n">File</span> <span class="n">-Path</span> <span class="nv">$PROFILE</span> <span class="n">-Force</span>
</span></code></pre></div>
<h3 id="step-3-edit-your-profile">Step 3: Edit Your Profile<a class="headerlink" href="#step-3-edit-your-profile" title="Permanent link">¶</a></h3>
<p>Open your profile in your preferred editor:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">notepad</span> <span class="nv">$PROFILE</span>        <span class="c"># Notepad</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">code</span> <span class="nv">$PROFILE</span>           <span class="c"># VS Code</span>
</span></code></pre></div>
<h3 id="step-4-copy-and-paste-the-script">Step 4: Copy and Paste the Script<a class="headerlink" href="#step-4-copy-and-paste-the-script" title="Permanent link">¶</a></h3>
<p>Copy the complete script from the <strong>"Complete Profile Script"</strong> section below and paste it into your profile file.</p>
<h3 id="step-5-save-and-reload">Step 5: Save and Reload<a class="headerlink" href="#step-5-save-and-reload" title="Permanent link">¶</a></h3>
<ol>
<li>Save the file</li>
<li>Reload the profile in PowerShell:</li>
</ol>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">&amp;</span> <span class="nv">$PROFILE</span>
</span></code></pre></div>
<p>You should see the startup message with all available commands.</p>
<h3 id="step-6-prerequisites">Step 6: Prerequisites<a class="headerlink" href="#step-6-prerequisites" title="Permanent link">¶</a></h3>
<p>Ensure you have the required PowerShell modules installed:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c"># Exchange Online Management</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">ExchangeOnlineManagement</span> <span class="n">-Force</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c"># Microsoft Graph</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Graph</span> <span class="n">-Force</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c"># SharePoint Online</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Online</span><span class="p">.</span><span class="n">SharePoint</span><span class="p">.</span><span class="n">PowerShell</span> <span class="n">-Force</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="c"># Microsoft Teams</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">MicrosoftTeams</span> <span class="n">-Force</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="c"># Security &amp; Compliance</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="c"># Usually installed with ExchangeOnlineManagement</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c"># Azure (optional)</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span> <span class="n">-Force</span>
</span></code></pre></div>
<h2 id="connection-commands">Connection Commands<a class="headerlink" href="#connection-commands" title="Permanent link">¶</a></h2>
<h3 id="exchange-online-only">Exchange Online Only<a class="headerlink" href="#exchange-online-only" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">exo</span>
</span></code></pre></div>
Connects to Exchange Online. Optionally specify a UPN:
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">exo</span> <span class="n">user</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div><p></p>
<h3 id="sharepoint-online">SharePoint Online<a class="headerlink" href="#sharepoint-online" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">spo</span> <span class="p">&lt;</span><span class="n">tenant-name</span><span class="p">&gt;</span>
</span></code></pre></div>
Examples:
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">spo</span> <span class="n">rivcounty</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">spo</span> <span class="n">rivcounty-admin</span><span class="p">.</span><span class="n">sharepoint</span><span class="p">.</span><span class="n">com</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">spo</span> <span class="n">https</span><span class="p">://</span><span class="n">rivcounty-admin</span><span class="p">.</span><span class="n">sharepoint</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div><p></p>
<h3 id="security-compliance-center">Security &amp; Compliance Center<a class="headerlink" href="#security-compliance-center" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">scc</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">scc</span> <span class="n">user</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
<h3 id="microsoft-teams">Microsoft Teams<a class="headerlink" href="#microsoft-teams" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">teams</span>
</span></code></pre></div>
<h3 id="azure">Azure<a class="headerlink" href="#azure" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">azure</span>
</span></code></pre></div>
<h3 id="full-m365-connection">Full M365 Connection<a class="headerlink" href="#full-m365-connection" title="Permanent link">¶</a></h3>
<p>Connects to both Exchange Online and Microsoft Graph:
</p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">m365</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">m365</span> <span class="n">user</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div><p></p>
<h3 id="check-connection-status">Check Connection Status<a class="headerlink" href="#check-connection-status" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">status</span>
</span></code></pre></div>
<h3 id="disconnect-all-services">Disconnect All Services<a class="headerlink" href="#disconnect-all-services" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">disco</span>
</span></code></pre></div>
<h2 id="quick-commands-email-mailbox">Quick Commands - Email &amp; Mailbox<a class="headerlink" href="#quick-commands-email-mailbox" title="Permanent link">¶</a></h2>
<h3 id="check-email-address">Check Email Address<a class="headerlink" href="#check-email-address" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">ce</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Returns all recipient objects matching that email pattern, including type, members (if group), and permissions (if shared mailbox).<p></p>
<h3 id="check-mailbox-type">Check Mailbox Type<a class="headerlink" href="#check-mailbox-type" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">cmt</span> <span class="n">shared</span><span class="p">.</span><span class="n">mailbox</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Shows whether it's a UserMailbox, SharedMailbox, etc.<p></p>
<h3 id="check-mailbox-permissions">Check Mailbox Permissions<a class="headerlink" href="#check-mailbox-permissions" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">cmp</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Shows Full Access and Send As permissions on the mailbox.<p></p>
<h3 id="grant-temporary-mailbox-access">Grant Temporary Mailbox Access<a class="headerlink" href="#grant-temporary-mailbox-access" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">grant</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Grants yourself Full Access to the mailbox (without auto-mapping). You can then open it in Outlook via "Open another mailbox".<p></p>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">grant</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span> <span class="n">admin</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Grant access to a different user.<p></p>
<h3 id="remove-temporary-mailbox-access">Remove Temporary Mailbox Access<a class="headerlink" href="#remove-temporary-mailbox-access" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">revoke</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
<h2 id="quick-commands-groups">Quick Commands - Groups<a class="headerlink" href="#quick-commands-groups" title="Permanent link">¶</a></h2>
<h3 id="check-group-members">Check Group Members<a class="headerlink" href="#check-group-members" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">cgm</span> <span class="n">DPSS-All</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Shows all members in a distribution or Microsoft 365 group.<p></p>
<h3 id="add-user-to-group">Add User to Group<a class="headerlink" href="#add-user-to-group" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nb">Add-UserToGroup</span> <span class="n">-User</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span> <span class="n">-Group</span> <span class="s2">"DPSS-All@company.com"</span>
</span></code></pre></div>
<h2 id="quick-commands-audit-troubleshooting">Quick Commands - Audit &amp; Troubleshooting<a class="headerlink" href="#quick-commands-audit-troubleshooting" title="Permanent link">¶</a></h2>
<h3 id="trace-email-delivery">Trace Email Delivery<a class="headerlink" href="#trace-email-delivery" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">te</span>
</span></code></pre></div>
Shows last 20 messages from the last 7 days. Optionally specify sender/recipient:<p></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">te</span> <span class="n">-Sender</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span> <span class="n">-Recipient</span> <span class="n">admin</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span> <span class="n">-Days</span> <span class="n">14</span>
</span></code></pre></div>
<h3 id="trace-auto-replies">Trace Auto-Replies<a class="headerlink" href="#trace-auto-replies" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">tar</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Shows automatic reply messages sent by the user in the last 10 days.<p></p>
<h3 id="who-changed-this">Who Changed This?<a class="headerlink" href="#who-changed-this" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">wc</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Searches audit logs for changes to that object in the last 30 days.<p></p>
<h3 id="check-mobile-devices">Check Mobile Devices<a class="headerlink" href="#check-mobile-devices" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">cmd</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Shows all mobile devices registered to that user's mailbox.<p></p>
<h3 id="fix-calendar-loop">Fix Calendar Loop<a class="headerlink" href="#fix-calendar-loop" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">fixloop</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Detects calendar response loops and optionally removes mobile devices causing the issue.<p></p>
<h2 id="quick-commands-user-memberships">Quick Commands - User Memberships<a class="headerlink" href="#quick-commands-user-memberships" title="Permanent link">¶</a></h2>
<h3 id="find-user-group-memberships">Find User Group Memberships<a class="headerlink" href="#find-user-group-memberships" title="Permanent link">¶</a></h3>
<p></p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">fum</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></div>
Searches for DPSS distribution groups, M365 groups, and shared mailbox access for the specified user.<p></p>
<h2 id="quick-commands-sharepoint">Quick Commands - SharePoint<a class="headerlink" href="#quick-commands-sharepoint" title="Permanent link">¶</a></h2>
<h3 id="add-user-to-spo-site-group">Add User to SPO Site Group<a class="headerlink" href="#add-user-to-spo-site-group" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">spouser</span> <span class="n">-SiteUrl</span> <span class="n">https</span><span class="p">://</span><span class="n">tenant</span><span class="p">.</span><span class="n">sharepoint</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">sites</span><span class="p">/</span><span class="n">sitename</span> <span class="n">-User</span> <span class="n">john</span><span class="p">.</span><span class="n">smith</span><span class="nv">@company</span><span class="p">.</span><span class="n">com</span> <span class="n">-GroupType</span> <span class="n">Members</span>
</span></code></pre></div>
<p>GroupType options: <code>Admins</code>, <code>Owners</code>, <code>Members</code>, <code>Visitors</code></p>
<h2 id="startup-display">Startup Display<a class="headerlink" href="#startup-display" title="Permanent link">¶</a></h2>
<p>When you open PowerShell, you'll see:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>========================================
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>  M365 ADMIN TOOLS LOADED
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>========================================
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>=== M365 CONNECTION STATUS ===
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>Exchange Online:
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>  ❌ Not connected
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>Microsoft Graph:
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>  ❌ Not connected
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>Connection commands:
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>  m365   - Connect to Exchange Online + Graph
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>  exo    - Connect to Exchange Online only
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>  spo    - Connect to SharePoint Online
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>  scc    - Connect to Security &amp; Compliance
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>  teams  - Connect to Microsoft Teams
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>  disco  - Disconnect all
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>  status - Check connection status
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>Quick commands:
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>  ce [email]    - Check email address
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>  cmt [mbx]     - Check mailbox type/resource
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>  cmp [mbx]     - Check mailbox permissions
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>  cgm [group]   - Check group members
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>  te            - Trace email
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>  tar [user]    - Trace auto-replies
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>  wc [object]   - Who changed this?
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>  cmd [user]    - Check mobile devices
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>  fum [user]    - Find user memberships
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>  grant [mbx]   - Grant temporary mailbox access
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>  revoke [mbx]  - Remove temporary mailbox access
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>  fixloop [user] - Fix calendar loop
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>  spouser       - Add user to SPO site group
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>========================================
</span></code></pre></div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">¶</a></h2>
<h3 id="profile-wont-run">Profile Won't Run<a class="headerlink" href="#profile-wont-run" title="Permanent link">¶</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nb">Set-ExecutionPolicy</span> <span class="n">-ExecutionPolicy</span> <span class="n">RemoteSigned</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span></code></pre></div>
<h3 id="profile-loaded-but-commands-not-found">Profile Loaded But Commands Not Found<a class="headerlink" href="#profile-loaded-but-commands-not-found" title="Permanent link">¶</a></h3>
<p>Reload the profile:
</p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="p">&amp;</span> <span class="nv">$PROFILE</span>
</span></code></pre></div><p></p>
<h3 id="module-not-found-errors">Module Not Found Errors<a class="headerlink" href="#module-not-found-errors" title="Permanent link">¶</a></h3>
<p>Install missing modules:
</p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">ModuleName</span> <span class="n">-Force</span>
</span></code></pre></div><p></p>
<h3 id="connection-errors">Connection Errors<a class="headerlink" href="#connection-errors" title="Permanent link">¶</a></h3>
<p>Verify you have proper M365 admin credentials and that your account has the necessary permissions in your organization.</p>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">¶</a></h2>
<ul>
<li>The profile automatically displays available commands on startup</li>
<li>All connection commands require appropriate M365 admin credentials</li>
<li>Some commands require specific licensing (Teams, SPO, etc.)</li>
<li>Audit log searches are limited to the last 90 days</li>
<li>Calendar loop fixes require mailbox management permissions</li>
<li>SharePoint commands require SPO admin credentials</li>
</ul>
<hr>
<h2 id="complete-profile-script">Complete Profile Script<a class="headerlink" href="#complete-profile-script" title="Permanent link">¶</a></h2>
<p>Copy the entire script below and paste it into your <code>$PROFILE</code> file:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="c"># M365 ADMIN PROFILE - COMPLETE</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="c"># Last Updated: 2025-12-05</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="c"># M365 SERVICE CONNECTION FUNCTIONS</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="k">function</span> <span class="nb">Connect-EXO</span> <span class="p">{</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$UserPrincipalName</span><span class="p">)</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Connecting to Exchange Online..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$UserPrincipalName</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>            <span class="nb">Connect-ExchangeOnline</span> <span class="n">-UserPrincipalName</span> <span class="nv">$UserPrincipalName</span> <span class="n">-ShowBanner</span><span class="p">:</span><span class="nv">$false</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>            <span class="nb">Connect-ExchangeOnline</span> <span class="n">-ShowBanner</span><span class="p">:</span><span class="nv">$false</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>        <span class="p">}</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Connected to Exchange Online"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>        <span class="nb">Get-ConnectionInformation</span> <span class="p">|</span> <span class="nb">FT </span><span class="n">UserPrincipalName</span><span class="p">,</span><span class="n">ConnectionUri</span><span class="p">,</span><span class="n">State</span> <span class="n">-AutoSize</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>    <span class="p">}</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to connect: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a>    <span class="p">}</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="p">}</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="k">function</span> <span class="nb">Connect-Graph</span> <span class="p">{</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string[]]</span><span class="nv">$Scopes</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">"User.Read.All"</span><span class="p">,</span> <span class="s2">"Group.ReadWrite.All"</span><span class="p">,</span> <span class="s2">"Directory.Read.All"</span><span class="p">))</span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Connecting to Microsoft Graph..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a>        <span class="nb">Connect-MgGraph</span> <span class="n">-Scopes</span> <span class="nv">$Scopes</span> <span class="n">-NoWelcome</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Connected to Microsoft Graph"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a>        <span class="nb">Get-MgContext</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Account</span><span class="p">,</span><span class="n">Scopes</span><span class="p">,</span><span class="n">TenantId</span>
</span><span id="__span-35-38"><a id="__codelineno-35-38" name="__codelineno-35-38" href="#__codelineno-35-38"></a>    <span class="p">}</span>
</span><span id="__span-35-39"><a id="__codelineno-35-39" name="__codelineno-35-39" href="#__codelineno-35-39"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-40"><a id="__codelineno-35-40" name="__codelineno-35-40" href="#__codelineno-35-40"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to connect: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-41"><a id="__codelineno-35-41" name="__codelineno-35-41" href="#__codelineno-35-41"></a>    <span class="p">}</span>
</span><span id="__span-35-42"><a id="__codelineno-35-42" name="__codelineno-35-42" href="#__codelineno-35-42"></a><span class="p">}</span>
</span><span id="__span-35-43"><a id="__codelineno-35-43" name="__codelineno-35-43" href="#__codelineno-35-43"></a>
</span><span id="__span-35-44"><a id="__codelineno-35-44" name="__codelineno-35-44" href="#__codelineno-35-44"></a><span class="k">function</span> <span class="nb">Connect-OnPremExchange</span> <span class="p">{</span>
</span><span id="__span-35-45"><a id="__codelineno-35-45" name="__codelineno-35-45" href="#__codelineno-35-45"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-46"><a id="__codelineno-35-46" name="__codelineno-35-46" href="#__codelineno-35-46"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-47"><a id="__codelineno-35-47" name="__codelineno-35-47" href="#__codelineno-35-47"></a>        <span class="no">[string]</span><span class="nv">$ServerFQDN</span>
</span><span id="__span-35-48"><a id="__codelineno-35-48" name="__codelineno-35-48" href="#__codelineno-35-48"></a>    <span class="p">)</span>
</span><span id="__span-35-49"><a id="__codelineno-35-49" name="__codelineno-35-49" href="#__codelineno-35-49"></a>
</span><span id="__span-35-50"><a id="__codelineno-35-50" name="__codelineno-35-50" href="#__codelineno-35-50"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Connecting to On-Premises Exchange..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-51"><a id="__codelineno-35-51" name="__codelineno-35-51" href="#__codelineno-35-51"></a>
</span><span id="__span-35-52"><a id="__codelineno-35-52" name="__codelineno-35-52" href="#__codelineno-35-52"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-53"><a id="__codelineno-35-53" name="__codelineno-35-53" href="#__codelineno-35-53"></a>        <span class="nv">$Session</span> <span class="p">=</span> <span class="nb">New-PSSession</span> <span class="n">-ConfigurationName</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Exchange</span> <span class="n">-ConnectionUri</span> <span class="s2">"http://$ServerFQDN/PowerShell/"</span> <span class="n">-Authentication</span> <span class="n">Kerberos</span>
</span><span id="__span-35-54"><a id="__codelineno-35-54" name="__codelineno-35-54" href="#__codelineno-35-54"></a>        <span class="nb">Import-PSSession</span> <span class="nv">$Session</span> <span class="n">-DisableNameChecking</span> <span class="n">-AllowClobber</span>
</span><span id="__span-35-55"><a id="__codelineno-35-55" name="__codelineno-35-55" href="#__codelineno-35-55"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Connected to On-Premises Exchange: $ServerFQDN"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-56"><a id="__codelineno-35-56" name="__codelineno-35-56" href="#__codelineno-35-56"></a>    <span class="p">}</span>
</span><span id="__span-35-57"><a id="__codelineno-35-57" name="__codelineno-35-57" href="#__codelineno-35-57"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-58"><a id="__codelineno-35-58" name="__codelineno-35-58" href="#__codelineno-35-58"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to connect: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-59"><a id="__codelineno-35-59" name="__codelineno-35-59" href="#__codelineno-35-59"></a>    <span class="p">}</span>
</span><span id="__span-35-60"><a id="__codelineno-35-60" name="__codelineno-35-60" href="#__codelineno-35-60"></a><span class="p">}</span>
</span><span id="__span-35-61"><a id="__codelineno-35-61" name="__codelineno-35-61" href="#__codelineno-35-61"></a>
</span><span id="__span-35-62"><a id="__codelineno-35-62" name="__codelineno-35-62" href="#__codelineno-35-62"></a><span class="k">function</span> <span class="nb">Connect-M365</span> <span class="p">{</span>
</span><span id="__span-35-63"><a id="__codelineno-35-63" name="__codelineno-35-63" href="#__codelineno-35-63"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$UserPrincipalName</span><span class="p">)</span>
</span><span id="__span-35-64"><a id="__codelineno-35-64" name="__codelineno-35-64" href="#__codelineno-35-64"></a>
</span><span id="__span-35-65"><a id="__codelineno-35-65" name="__codelineno-35-65" href="#__codelineno-35-65"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">========================================"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-66"><a id="__codelineno-35-66" name="__codelineno-35-66" href="#__codelineno-35-66"></a>    <span class="nb">Write-Host</span> <span class="s2">"  CONNECTING TO M365 SERVICES"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-67"><a id="__codelineno-35-67" name="__codelineno-35-67" href="#__codelineno-35-67"></a>    <span class="nb">Write-Host</span> <span class="s2">"========================================"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-68"><a id="__codelineno-35-68" name="__codelineno-35-68" href="#__codelineno-35-68"></a>    <span class="nb">Write-Host</span> <span class="s2">""</span>
</span><span id="__span-35-69"><a id="__codelineno-35-69" name="__codelineno-35-69" href="#__codelineno-35-69"></a>
</span><span id="__span-35-70"><a id="__codelineno-35-70" name="__codelineno-35-70" href="#__codelineno-35-70"></a>    <span class="nb">Connect-EXO</span> <span class="n">-UserPrincipalName</span> <span class="nv">$UserPrincipalName</span>
</span><span id="__span-35-71"><a id="__codelineno-35-71" name="__codelineno-35-71" href="#__codelineno-35-71"></a>    <span class="nb">Connect-Graph</span>
</span><span id="__span-35-72"><a id="__codelineno-35-72" name="__codelineno-35-72" href="#__codelineno-35-72"></a>
</span><span id="__span-35-73"><a id="__codelineno-35-73" name="__codelineno-35-73" href="#__codelineno-35-73"></a>    <span class="nb">Write-Host</span> <span class="s2">""</span>
</span><span id="__span-35-74"><a id="__codelineno-35-74" name="__codelineno-35-74" href="#__codelineno-35-74"></a>    <span class="nb">Write-Host</span> <span class="s2">"========================================"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-75"><a id="__codelineno-35-75" name="__codelineno-35-75" href="#__codelineno-35-75"></a>    <span class="nb">Write-Host</span> <span class="s2">"  CONNECTION COMPLETE"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-76"><a id="__codelineno-35-76" name="__codelineno-35-76" href="#__codelineno-35-76"></a>    <span class="nb">Write-Host</span> <span class="s2">"========================================"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-77"><a id="__codelineno-35-77" name="__codelineno-35-77" href="#__codelineno-35-77"></a>    <span class="nb">Write-Host</span> <span class="s2">""</span>
</span><span id="__span-35-78"><a id="__codelineno-35-78" name="__codelineno-35-78" href="#__codelineno-35-78"></a><span class="p">}</span>
</span><span id="__span-35-79"><a id="__codelineno-35-79" name="__codelineno-35-79" href="#__codelineno-35-79"></a>
</span><span id="__span-35-80"><a id="__codelineno-35-80" name="__codelineno-35-80" href="#__codelineno-35-80"></a><span class="k">function</span> <span class="nb">Connect-SCC</span> <span class="p">{</span>
</span><span id="__span-35-81"><a id="__codelineno-35-81" name="__codelineno-35-81" href="#__codelineno-35-81"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$UserPrincipalName</span><span class="p">)</span>
</span><span id="__span-35-82"><a id="__codelineno-35-82" name="__codelineno-35-82" href="#__codelineno-35-82"></a>
</span><span id="__span-35-83"><a id="__codelineno-35-83" name="__codelineno-35-83" href="#__codelineno-35-83"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Connecting to Security &amp; Compliance Center..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-84"><a id="__codelineno-35-84" name="__codelineno-35-84" href="#__codelineno-35-84"></a>
</span><span id="__span-35-85"><a id="__codelineno-35-85" name="__codelineno-35-85" href="#__codelineno-35-85"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-86"><a id="__codelineno-35-86" name="__codelineno-35-86" href="#__codelineno-35-86"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$UserPrincipalName</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-87"><a id="__codelineno-35-87" name="__codelineno-35-87" href="#__codelineno-35-87"></a>            <span class="nb">Connect-IPPSSession</span> <span class="n">-UserPrincipalName</span> <span class="nv">$UserPrincipalName</span> <span class="n">-ShowBanner</span><span class="p">:</span><span class="nv">$false</span>
</span><span id="__span-35-88"><a id="__codelineno-35-88" name="__codelineno-35-88" href="#__codelineno-35-88"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-89"><a id="__codelineno-35-89" name="__codelineno-35-89" href="#__codelineno-35-89"></a>            <span class="nb">Connect-IPPSSession</span> <span class="n">-ShowBanner</span><span class="p">:</span><span class="nv">$false</span>
</span><span id="__span-35-90"><a id="__codelineno-35-90" name="__codelineno-35-90" href="#__codelineno-35-90"></a>        <span class="p">}</span>
</span><span id="__span-35-91"><a id="__codelineno-35-91" name="__codelineno-35-91" href="#__codelineno-35-91"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Connected to Security &amp; Compliance Center"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-92"><a id="__codelineno-35-92" name="__codelineno-35-92" href="#__codelineno-35-92"></a>    <span class="p">}</span>
</span><span id="__span-35-93"><a id="__codelineno-35-93" name="__codelineno-35-93" href="#__codelineno-35-93"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-94"><a id="__codelineno-35-94" name="__codelineno-35-94" href="#__codelineno-35-94"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to connect: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-95"><a id="__codelineno-35-95" name="__codelineno-35-95" href="#__codelineno-35-95"></a>    <span class="p">}</span>
</span><span id="__span-35-96"><a id="__codelineno-35-96" name="__codelineno-35-96" href="#__codelineno-35-96"></a><span class="p">}</span>
</span><span id="__span-35-97"><a id="__codelineno-35-97" name="__codelineno-35-97" href="#__codelineno-35-97"></a>
</span><span id="__span-35-98"><a id="__codelineno-35-98" name="__codelineno-35-98" href="#__codelineno-35-98"></a><span class="k">function</span> <span class="nb">Connect-SPO</span> <span class="p">{</span>
</span><span id="__span-35-99"><a id="__codelineno-35-99" name="__codelineno-35-99" href="#__codelineno-35-99"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-100"><a id="__codelineno-35-100" name="__codelineno-35-100" href="#__codelineno-35-100"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-101"><a id="__codelineno-35-101" name="__codelineno-35-101" href="#__codelineno-35-101"></a>        <span class="no">[string]</span><span class="nv">$TenantName</span>
</span><span id="__span-35-102"><a id="__codelineno-35-102" name="__codelineno-35-102" href="#__codelineno-35-102"></a>    <span class="p">)</span>
</span><span id="__span-35-103"><a id="__codelineno-35-103" name="__codelineno-35-103" href="#__codelineno-35-103"></a>
</span><span id="__span-35-104"><a id="__codelineno-35-104" name="__codelineno-35-104" href="#__codelineno-35-104"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Connecting to SharePoint Online..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-105"><a id="__codelineno-35-105" name="__codelineno-35-105" href="#__codelineno-35-105"></a>
</span><span id="__span-35-106"><a id="__codelineno-35-106" name="__codelineno-35-106" href="#__codelineno-35-106"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-107"><a id="__codelineno-35-107" name="__codelineno-35-107" href="#__codelineno-35-107"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Get-Module</span> <span class="n">-ListAvailable</span> <span class="n">-Name</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Online</span><span class="p">.</span><span class="n">SharePoint</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-35-108"><a id="__codelineno-35-108" name="__codelineno-35-108" href="#__codelineno-35-108"></a>            <span class="nb">Write-Host</span> <span class="s2">"❌ SharePoint Online Management Shell module not installed"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-109"><a id="__codelineno-35-109" name="__codelineno-35-109" href="#__codelineno-35-109"></a>            <span class="nb">Write-Host</span> <span class="s2">"Install with: Install-Module -Name Microsoft.Online.SharePoint.PowerShell"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-110"><a id="__codelineno-35-110" name="__codelineno-35-110" href="#__codelineno-35-110"></a>            <span class="k">return</span>
</span><span id="__span-35-111"><a id="__codelineno-35-111" name="__codelineno-35-111" href="#__codelineno-35-111"></a>        <span class="p">}</span>
</span><span id="__span-35-112"><a id="__codelineno-35-112" name="__codelineno-35-112" href="#__codelineno-35-112"></a>
</span><span id="__span-35-113"><a id="__codelineno-35-113" name="__codelineno-35-113" href="#__codelineno-35-113"></a>        <span class="c"># Handle both formats: just tenant name OR full admin URL</span>
</span><span id="__span-35-114"><a id="__codelineno-35-114" name="__codelineno-35-114" href="#__codelineno-35-114"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$TenantName</span> <span class="o">-match</span> <span class="s1">'^https?://'</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-115"><a id="__codelineno-35-115" name="__codelineno-35-115" href="#__codelineno-35-115"></a>            <span class="c"># Full URL provided</span>
</span><span id="__span-35-116"><a id="__codelineno-35-116" name="__codelineno-35-116" href="#__codelineno-35-116"></a>            <span class="nv">$adminUrl</span> <span class="p">=</span> <span class="nv">$TenantName</span>
</span><span id="__span-35-117"><a id="__codelineno-35-117" name="__codelineno-35-117" href="#__codelineno-35-117"></a>        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$TenantName</span> <span class="o">-match</span> <span class="s1">'\.sharepoint\.com'</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-118"><a id="__codelineno-35-118" name="__codelineno-35-118" href="#__codelineno-35-118"></a>            <span class="c"># Domain format provided (e.g., rivcounty-admin.sharepoint.com)</span>
</span><span id="__span-35-119"><a id="__codelineno-35-119" name="__codelineno-35-119" href="#__codelineno-35-119"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$TenantName</span> <span class="o">-notmatch</span> <span class="s1">'-admin\.sharepoint\.com$'</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-120"><a id="__codelineno-35-120" name="__codelineno-35-120" href="#__codelineno-35-120"></a>                <span class="c"># If not already admin URL, extract tenant and build admin URL</span>
</span><span id="__span-35-121"><a id="__codelineno-35-121" name="__codelineno-35-121" href="#__codelineno-35-121"></a>                <span class="nv">$tenant</span> <span class="p">=</span> <span class="nv">$TenantName</span> <span class="o">-replace</span> <span class="s1">'\.sharepoint\.com.*'</span><span class="p">,</span> <span class="s1">''</span>
</span><span id="__span-35-122"><a id="__codelineno-35-122" name="__codelineno-35-122" href="#__codelineno-35-122"></a>                <span class="nv">$adminUrl</span> <span class="p">=</span> <span class="s2">"https://$tenant-admin.sharepoint.com"</span>
</span><span id="__span-35-123"><a id="__codelineno-35-123" name="__codelineno-35-123" href="#__codelineno-35-123"></a>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-124"><a id="__codelineno-35-124" name="__codelineno-35-124" href="#__codelineno-35-124"></a>                <span class="c"># Already admin URL</span>
</span><span id="__span-35-125"><a id="__codelineno-35-125" name="__codelineno-35-125" href="#__codelineno-35-125"></a>                <span class="nv">$adminUrl</span> <span class="p">=</span> <span class="s2">"https://$TenantName"</span>
</span><span id="__span-35-126"><a id="__codelineno-35-126" name="__codelineno-35-126" href="#__codelineno-35-126"></a>            <span class="p">}</span>
</span><span id="__span-35-127"><a id="__codelineno-35-127" name="__codelineno-35-127" href="#__codelineno-35-127"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-128"><a id="__codelineno-35-128" name="__codelineno-35-128" href="#__codelineno-35-128"></a>            <span class="c"># Just tenant name provided (e.g., rivcounty)</span>
</span><span id="__span-35-129"><a id="__codelineno-35-129" name="__codelineno-35-129" href="#__codelineno-35-129"></a>            <span class="nv">$adminUrl</span> <span class="p">=</span> <span class="s2">"https://$TenantName-admin.sharepoint.com"</span>
</span><span id="__span-35-130"><a id="__codelineno-35-130" name="__codelineno-35-130" href="#__codelineno-35-130"></a>        <span class="p">}</span>
</span><span id="__span-35-131"><a id="__codelineno-35-131" name="__codelineno-35-131" href="#__codelineno-35-131"></a>
</span><span id="__span-35-132"><a id="__codelineno-35-132" name="__codelineno-35-132" href="#__codelineno-35-132"></a>        <span class="nb">Connect-SPOService</span> <span class="n">-Url</span> <span class="nv">$adminUrl</span>
</span><span id="__span-35-133"><a id="__codelineno-35-133" name="__codelineno-35-133" href="#__codelineno-35-133"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Connected to SharePoint Online: $adminUrl"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-134"><a id="__codelineno-35-134" name="__codelineno-35-134" href="#__codelineno-35-134"></a>    <span class="p">}</span>
</span><span id="__span-35-135"><a id="__codelineno-35-135" name="__codelineno-35-135" href="#__codelineno-35-135"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-136"><a id="__codelineno-35-136" name="__codelineno-35-136" href="#__codelineno-35-136"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to connect: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-137"><a id="__codelineno-35-137" name="__codelineno-35-137" href="#__codelineno-35-137"></a>    <span class="p">}</span>
</span><span id="__span-35-138"><a id="__codelineno-35-138" name="__codelineno-35-138" href="#__codelineno-35-138"></a><span class="p">}</span>
</span><span id="__span-35-139"><a id="__codelineno-35-139" name="__codelineno-35-139" href="#__codelineno-35-139"></a>
</span><span id="__span-35-140"><a id="__codelineno-35-140" name="__codelineno-35-140" href="#__codelineno-35-140"></a><span class="k">function</span> <span class="nb">Connect-Teams</span> <span class="p">{</span>
</span><span id="__span-35-141"><a id="__codelineno-35-141" name="__codelineno-35-141" href="#__codelineno-35-141"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Connecting to Microsoft Teams..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-142"><a id="__codelineno-35-142" name="__codelineno-35-142" href="#__codelineno-35-142"></a>
</span><span id="__span-35-143"><a id="__codelineno-35-143" name="__codelineno-35-143" href="#__codelineno-35-143"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-144"><a id="__codelineno-35-144" name="__codelineno-35-144" href="#__codelineno-35-144"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Get-Module</span> <span class="n">-ListAvailable</span> <span class="n">-Name</span> <span class="n">MicrosoftTeams</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-35-145"><a id="__codelineno-35-145" name="__codelineno-35-145" href="#__codelineno-35-145"></a>            <span class="nb">Write-Host</span> <span class="s2">"❌ Microsoft Teams module not installed"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-146"><a id="__codelineno-35-146" name="__codelineno-35-146" href="#__codelineno-35-146"></a>            <span class="nb">Write-Host</span> <span class="s2">"Install with: Install-Module -Name MicrosoftTeams"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-147"><a id="__codelineno-35-147" name="__codelineno-35-147" href="#__codelineno-35-147"></a>            <span class="k">return</span>
</span><span id="__span-35-148"><a id="__codelineno-35-148" name="__codelineno-35-148" href="#__codelineno-35-148"></a>        <span class="p">}</span>
</span><span id="__span-35-149"><a id="__codelineno-35-149" name="__codelineno-35-149" href="#__codelineno-35-149"></a>
</span><span id="__span-35-150"><a id="__codelineno-35-150" name="__codelineno-35-150" href="#__codelineno-35-150"></a>        <span class="nb">Connect-MicrosoftTeams</span>
</span><span id="__span-35-151"><a id="__codelineno-35-151" name="__codelineno-35-151" href="#__codelineno-35-151"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Connected to Microsoft Teams"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-152"><a id="__codelineno-35-152" name="__codelineno-35-152" href="#__codelineno-35-152"></a>
</span><span id="__span-35-153"><a id="__codelineno-35-153" name="__codelineno-35-153" href="#__codelineno-35-153"></a>        <span class="nv">$tenant</span> <span class="p">=</span> <span class="nb">Get-CsTenant</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-154"><a id="__codelineno-35-154" name="__codelineno-35-154" href="#__codelineno-35-154"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$tenant</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-155"><a id="__codelineno-35-155" name="__codelineno-35-155" href="#__codelineno-35-155"></a>            <span class="nb">Write-Host</span> <span class="s2">"Tenant: </span><span class="p">$(</span><span class="nv">$tenant</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-156"><a id="__codelineno-35-156" name="__codelineno-35-156" href="#__codelineno-35-156"></a>        <span class="p">}</span>
</span><span id="__span-35-157"><a id="__codelineno-35-157" name="__codelineno-35-157" href="#__codelineno-35-157"></a>    <span class="p">}</span>
</span><span id="__span-35-158"><a id="__codelineno-35-158" name="__codelineno-35-158" href="#__codelineno-35-158"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-159"><a id="__codelineno-35-159" name="__codelineno-35-159" href="#__codelineno-35-159"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to connect: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-160"><a id="__codelineno-35-160" name="__codelineno-35-160" href="#__codelineno-35-160"></a>    <span class="p">}</span>
</span><span id="__span-35-161"><a id="__codelineno-35-161" name="__codelineno-35-161" href="#__codelineno-35-161"></a><span class="p">}</span>
</span><span id="__span-35-162"><a id="__codelineno-35-162" name="__codelineno-35-162" href="#__codelineno-35-162"></a>
</span><span id="__span-35-163"><a id="__codelineno-35-163" name="__codelineno-35-163" href="#__codelineno-35-163"></a><span class="k">function</span> <span class="nb">Connect-Azure</span> <span class="p">{</span>
</span><span id="__span-35-164"><a id="__codelineno-35-164" name="__codelineno-35-164" href="#__codelineno-35-164"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Connecting to Azure (Az module)..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-165"><a id="__codelineno-35-165" name="__codelineno-35-165" href="#__codelineno-35-165"></a>
</span><span id="__span-35-166"><a id="__codelineno-35-166" name="__codelineno-35-166" href="#__codelineno-35-166"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-167"><a id="__codelineno-35-167" name="__codelineno-35-167" href="#__codelineno-35-167"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Get-Module</span> <span class="n">-ListAvailable</span> <span class="n">-Name</span> <span class="n">Az</span><span class="p">.</span><span class="n">Accounts</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-35-168"><a id="__codelineno-35-168" name="__codelineno-35-168" href="#__codelineno-35-168"></a>            <span class="nb">Write-Host</span> <span class="s2">"❌ Azure PowerShell (Az) module not installed"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-169"><a id="__codelineno-35-169" name="__codelineno-35-169" href="#__codelineno-35-169"></a>            <span class="nb">Write-Host</span> <span class="s2">"Install with: Install-Module -Name Az"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-170"><a id="__codelineno-35-170" name="__codelineno-35-170" href="#__codelineno-35-170"></a>            <span class="k">return</span>
</span><span id="__span-35-171"><a id="__codelineno-35-171" name="__codelineno-35-171" href="#__codelineno-35-171"></a>        <span class="p">}</span>
</span><span id="__span-35-172"><a id="__codelineno-35-172" name="__codelineno-35-172" href="#__codelineno-35-172"></a>
</span><span id="__span-35-173"><a id="__codelineno-35-173" name="__codelineno-35-173" href="#__codelineno-35-173"></a>        <span class="nb">Connect-AzAccount</span>
</span><span id="__span-35-174"><a id="__codelineno-35-174" name="__codelineno-35-174" href="#__codelineno-35-174"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Connected to Azure"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-175"><a id="__codelineno-35-175" name="__codelineno-35-175" href="#__codelineno-35-175"></a>        <span class="nb">Get-AzContext</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Account</span><span class="p">,</span><span class="n">Subscription</span><span class="p">,</span><span class="n">Tenant</span>
</span><span id="__span-35-176"><a id="__codelineno-35-176" name="__codelineno-35-176" href="#__codelineno-35-176"></a>    <span class="p">}</span>
</span><span id="__span-35-177"><a id="__codelineno-35-177" name="__codelineno-35-177" href="#__codelineno-35-177"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-178"><a id="__codelineno-35-178" name="__codelineno-35-178" href="#__codelineno-35-178"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to connect: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-179"><a id="__codelineno-35-179" name="__codelineno-35-179" href="#__codelineno-35-179"></a>    <span class="p">}</span>
</span><span id="__span-35-180"><a id="__codelineno-35-180" name="__codelineno-35-180" href="#__codelineno-35-180"></a><span class="p">}</span>
</span><span id="__span-35-181"><a id="__codelineno-35-181" name="__codelineno-35-181" href="#__codelineno-35-181"></a>
</span><span id="__span-35-182"><a id="__codelineno-35-182" name="__codelineno-35-182" href="#__codelineno-35-182"></a><span class="k">function</span> <span class="nb">Disconnect-M365</span> <span class="p">{</span>
</span><span id="__span-35-183"><a id="__codelineno-35-183" name="__codelineno-35-183" href="#__codelineno-35-183"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Disconnecting from all M365 services..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-184"><a id="__codelineno-35-184" name="__codelineno-35-184" href="#__codelineno-35-184"></a>
</span><span id="__span-35-185"><a id="__codelineno-35-185" name="__codelineno-35-185" href="#__codelineno-35-185"></a>    <span class="k">try</span> <span class="p">{</span> <span class="nb">Disconnect-ExchangeOnline</span> <span class="n">-Confirm</span><span class="p">:</span><span class="nv">$false</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">;</span> <span class="nb">Write-Host</span> <span class="s2">"✅ Disconnected from Exchange Online"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>
</span><span id="__span-35-186"><a id="__codelineno-35-186" name="__codelineno-35-186" href="#__codelineno-35-186"></a>    <span class="k">try</span> <span class="p">{</span> <span class="nb">Disconnect-MgGraph</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">;</span> <span class="nb">Write-Host</span> <span class="s2">"✅ Disconnected from Microsoft Graph"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>
</span><span id="__span-35-187"><a id="__codelineno-35-187" name="__codelineno-35-187" href="#__codelineno-35-187"></a>    <span class="k">try</span> <span class="p">{</span> <span class="nb">Disconnect-IPPSSession</span> <span class="n">-Confirm</span><span class="p">:</span><span class="nv">$false</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">;</span> <span class="nb">Write-Host</span> <span class="s2">"✅ Disconnected from Security &amp; Compliance"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>
</span><span id="__span-35-188"><a id="__codelineno-35-188" name="__codelineno-35-188" href="#__codelineno-35-188"></a>    <span class="k">try</span> <span class="p">{</span> <span class="nb">Disconnect-SPOService</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">;</span> <span class="nb">Write-Host</span> <span class="s2">"✅ Disconnected from SharePoint Online"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>
</span><span id="__span-35-189"><a id="__codelineno-35-189" name="__codelineno-35-189" href="#__codelineno-35-189"></a>    <span class="k">try</span> <span class="p">{</span> <span class="nb">Disconnect-MicrosoftTeams</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">;</span> <span class="nb">Write-Host</span> <span class="s2">"✅ Disconnected from Microsoft Teams"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>
</span><span id="__span-35-190"><a id="__codelineno-35-190" name="__codelineno-35-190" href="#__codelineno-35-190"></a>    <span class="k">try</span> <span class="p">{</span> <span class="nb">Disconnect-AzAccount</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">;</span> <span class="nb">Write-Host</span> <span class="s2">"✅ Disconnected from Azure"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>
</span><span id="__span-35-191"><a id="__codelineno-35-191" name="__codelineno-35-191" href="#__codelineno-35-191"></a>
</span><span id="__span-35-192"><a id="__codelineno-35-192" name="__codelineno-35-192" href="#__codelineno-35-192"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">All disconnections complete"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-193"><a id="__codelineno-35-193" name="__codelineno-35-193" href="#__codelineno-35-193"></a><span class="p">}</span>
</span><span id="__span-35-194"><a id="__codelineno-35-194" name="__codelineno-35-194" href="#__codelineno-35-194"></a>
</span><span id="__span-35-195"><a id="__codelineno-35-195" name="__codelineno-35-195" href="#__codelineno-35-195"></a><span class="k">function</span> <span class="nb">Get-M365ConnectionStatus</span> <span class="p">{</span>
</span><span id="__span-35-196"><a id="__codelineno-35-196" name="__codelineno-35-196" href="#__codelineno-35-196"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== M365 CONNECTION STATUS ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-197"><a id="__codelineno-35-197" name="__codelineno-35-197" href="#__codelineno-35-197"></a>
</span><span id="__span-35-198"><a id="__codelineno-35-198" name="__codelineno-35-198" href="#__codelineno-35-198"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Exchange Online:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-199"><a id="__codelineno-35-199" name="__codelineno-35-199" href="#__codelineno-35-199"></a>    <span class="nv">$exoConn</span> <span class="p">=</span> <span class="nb">Get-ConnectionInformation</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-200"><a id="__codelineno-35-200" name="__codelineno-35-200" href="#__codelineno-35-200"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$exoConn</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-201"><a id="__codelineno-35-201" name="__codelineno-35-201" href="#__codelineno-35-201"></a>        <span class="nb">Write-Host</span> <span class="s2">"  ✅ Connected as: </span><span class="p">$(</span><span class="nv">$exoConn</span><span class="p">.</span><span class="n">UserPrincipalName</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-202"><a id="__codelineno-35-202" name="__codelineno-35-202" href="#__codelineno-35-202"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-203"><a id="__codelineno-35-203" name="__codelineno-35-203" href="#__codelineno-35-203"></a>        <span class="nb">Write-Host</span> <span class="s2">"  ❌ Not connected"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-204"><a id="__codelineno-35-204" name="__codelineno-35-204" href="#__codelineno-35-204"></a>    <span class="p">}</span>
</span><span id="__span-35-205"><a id="__codelineno-35-205" name="__codelineno-35-205" href="#__codelineno-35-205"></a>
</span><span id="__span-35-206"><a id="__codelineno-35-206" name="__codelineno-35-206" href="#__codelineno-35-206"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Microsoft Graph:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-207"><a id="__codelineno-35-207" name="__codelineno-35-207" href="#__codelineno-35-207"></a>    <span class="nv">$graphConn</span> <span class="p">=</span> <span class="nb">Get-MgContext</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-208"><a id="__codelineno-35-208" name="__codelineno-35-208" href="#__codelineno-35-208"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$graphConn</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-209"><a id="__codelineno-35-209" name="__codelineno-35-209" href="#__codelineno-35-209"></a>        <span class="nb">Write-Host</span> <span class="s2">"  ✅ Connected as: </span><span class="p">$(</span><span class="nv">$graphConn</span><span class="p">.</span><span class="n">Account</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-210"><a id="__codelineno-35-210" name="__codelineno-35-210" href="#__codelineno-35-210"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-211"><a id="__codelineno-35-211" name="__codelineno-35-211" href="#__codelineno-35-211"></a>        <span class="nb">Write-Host</span> <span class="s2">"  ❌ Not connected"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-212"><a id="__codelineno-35-212" name="__codelineno-35-212" href="#__codelineno-35-212"></a>    <span class="p">}</span>
</span><span id="__span-35-213"><a id="__codelineno-35-213" name="__codelineno-35-213" href="#__codelineno-35-213"></a>
</span><span id="__span-35-214"><a id="__codelineno-35-214" name="__codelineno-35-214" href="#__codelineno-35-214"></a>    <span class="nb">Write-Host</span> <span class="s2">""</span>
</span><span id="__span-35-215"><a id="__codelineno-35-215" name="__codelineno-35-215" href="#__codelineno-35-215"></a><span class="p">}</span>
</span><span id="__span-35-216"><a id="__codelineno-35-216" name="__codelineno-35-216" href="#__codelineno-35-216"></a>
</span><span id="__span-35-217"><a id="__codelineno-35-217" name="__codelineno-35-217" href="#__codelineno-35-217"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-218"><a id="__codelineno-35-218" name="__codelineno-35-218" href="#__codelineno-35-218"></a><span class="c"># EMAIL &amp; GROUP MANAGEMENT FUNCTIONS</span>
</span><span id="__span-35-219"><a id="__codelineno-35-219" name="__codelineno-35-219" href="#__codelineno-35-219"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-220"><a id="__codelineno-35-220" name="__codelineno-35-220" href="#__codelineno-35-220"></a>
</span><span id="__span-35-221"><a id="__codelineno-35-221" name="__codelineno-35-221" href="#__codelineno-35-221"></a><span class="k">function</span> <span class="nb">Get-MailboxType</span> <span class="p">{</span>
</span><span id="__span-35-222"><a id="__codelineno-35-222" name="__codelineno-35-222" href="#__codelineno-35-222"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-223"><a id="__codelineno-35-223" name="__codelineno-35-223" href="#__codelineno-35-223"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-224"><a id="__codelineno-35-224" name="__codelineno-35-224" href="#__codelineno-35-224"></a>        <span class="no">[string]</span><span class="nv">$Mailbox</span>
</span><span id="__span-35-225"><a id="__codelineno-35-225" name="__codelineno-35-225" href="#__codelineno-35-225"></a>    <span class="p">)</span>
</span><span id="__span-35-226"><a id="__codelineno-35-226" name="__codelineno-35-226" href="#__codelineno-35-226"></a>
</span><span id="__span-35-227"><a id="__codelineno-35-227" name="__codelineno-35-227" href="#__codelineno-35-227"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== MAILBOX TYPE FOR: $Mailbox ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-228"><a id="__codelineno-35-228" name="__codelineno-35-228" href="#__codelineno-35-228"></a>
</span><span id="__span-35-229"><a id="__codelineno-35-229" name="__codelineno-35-229" href="#__codelineno-35-229"></a>    <span class="nb">Get-Mailbox</span> <span class="nv">$Mailbox</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span>
</span><span id="__span-35-230"><a id="__codelineno-35-230" name="__codelineno-35-230" href="#__codelineno-35-230"></a>        <span class="nb">Select-Object</span> <span class="n">DisplayName</span><span class="p">,</span><span class="n">RecipientTypeDetails</span><span class="p">,</span><span class="n">ResourceType</span> <span class="p">|</span> <span class="nb">Format-List</span>
</span><span id="__span-35-231"><a id="__codelineno-35-231" name="__codelineno-35-231" href="#__codelineno-35-231"></a><span class="p">}</span>
</span><span id="__span-35-232"><a id="__codelineno-35-232" name="__codelineno-35-232" href="#__codelineno-35-232"></a>
</span><span id="__span-35-233"><a id="__codelineno-35-233" name="__codelineno-35-233" href="#__codelineno-35-233"></a><span class="k">function</span> <span class="n">Check-Email</span> <span class="p">{</span>
</span><span id="__span-35-234"><a id="__codelineno-35-234" name="__codelineno-35-234" href="#__codelineno-35-234"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$Email</span><span class="p">)</span>
</span><span id="__span-35-235"><a id="__codelineno-35-235" name="__codelineno-35-235" href="#__codelineno-35-235"></a>
</span><span id="__span-35-236"><a id="__codelineno-35-236" name="__codelineno-35-236" href="#__codelineno-35-236"></a>    <span class="nv">$r</span> <span class="p">=</span> <span class="nb">Get-Recipient</span> <span class="n">-Filter</span> <span class="s2">"EmailAddresses -like '*$Email*'"</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-237"><a id="__codelineno-35-237" name="__codelineno-35-237" href="#__codelineno-35-237"></a>
</span><span id="__span-35-238"><a id="__codelineno-35-238" name="__codelineno-35-238" href="#__codelineno-35-238"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-239"><a id="__codelineno-35-239" name="__codelineno-35-239" href="#__codelineno-35-239"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">NOT FOUND: $Email"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-240"><a id="__codelineno-35-240" name="__codelineno-35-240" href="#__codelineno-35-240"></a>        <span class="k">return</span>
</span><span id="__span-35-241"><a id="__codelineno-35-241" name="__codelineno-35-241" href="#__codelineno-35-241"></a>    <span class="p">}</span>
</span><span id="__span-35-242"><a id="__codelineno-35-242" name="__codelineno-35-242" href="#__codelineno-35-242"></a>
</span><span id="__span-35-243"><a id="__codelineno-35-243" name="__codelineno-35-243" href="#__codelineno-35-243"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">FOUND: </span><span class="p">$(</span><span class="nv">$r</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> object(s)"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-244"><a id="__codelineno-35-244" name="__codelineno-35-244" href="#__codelineno-35-244"></a>    <span class="nv">$r</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-35-245"><a id="__codelineno-35-245" name="__codelineno-35-245" href="#__codelineno-35-245"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-246"><a id="__codelineno-35-246" name="__codelineno-35-246" href="#__codelineno-35-246"></a>        <span class="nb">Write-Host</span> <span class="s2">"  Type: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">RecipientTypeDetails</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-35-247"><a id="__codelineno-35-247" name="__codelineno-35-247" href="#__codelineno-35-247"></a>        <span class="nb">Write-Host</span> <span class="s2">"  Name: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-35-248"><a id="__codelineno-35-248" name="__codelineno-35-248" href="#__codelineno-35-248"></a>
</span><span id="__span-35-249"><a id="__codelineno-35-249" name="__codelineno-35-249" href="#__codelineno-35-249"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">RecipientTypeDetails</span> <span class="o">-match</span> <span class="s2">"Group"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-250"><a id="__codelineno-35-250" name="__codelineno-35-250" href="#__codelineno-35-250"></a>            <span class="nv">$g</span> <span class="p">=</span> <span class="nb">Get-DistributionGroup</span> <span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-251"><a id="__codelineno-35-251" name="__codelineno-35-251" href="#__codelineno-35-251"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$g</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-252"><a id="__codelineno-35-252" name="__codelineno-35-252" href="#__codelineno-35-252"></a>                <span class="nb">Write-Host</span> <span class="s2">"  Members: </span><span class="p">$(</span><span class="nv">$g</span><span class="p">.</span><span class="n">MemberCount</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-35-253"><a id="__codelineno-35-253" name="__codelineno-35-253" href="#__codelineno-35-253"></a>            <span class="p">}</span>
</span><span id="__span-35-254"><a id="__codelineno-35-254" name="__codelineno-35-254" href="#__codelineno-35-254"></a>        <span class="p">}</span>
</span><span id="__span-35-255"><a id="__codelineno-35-255" name="__codelineno-35-255" href="#__codelineno-35-255"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">RecipientTypeDetails</span> <span class="o">-eq</span> <span class="s2">"SharedMailbox"</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-256"><a id="__codelineno-35-256" name="__codelineno-35-256" href="#__codelineno-35-256"></a>            <span class="nv">$p</span> <span class="p">=</span> <span class="nb">Get-MailboxPermission</span> <span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span>
</span><span id="__span-35-257"><a id="__codelineno-35-257" name="__codelineno-35-257" href="#__codelineno-35-257"></a>                <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">User</span> <span class="o">-notlike</span> <span class="s2">"NT*"</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">User</span> <span class="o">-notlike</span> <span class="s2">"S-1-5-*"</span><span class="p">}</span>
</span><span id="__span-35-258"><a id="__codelineno-35-258" name="__codelineno-35-258" href="#__codelineno-35-258"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$p</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-259"><a id="__codelineno-35-259" name="__codelineno-35-259" href="#__codelineno-35-259"></a>                <span class="nb">Write-Host</span> <span class="s2">"  Access: </span><span class="p">$(</span><span class="nv">$p</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> users"</span>
</span><span id="__span-35-260"><a id="__codelineno-35-260" name="__codelineno-35-260" href="#__codelineno-35-260"></a>            <span class="p">}</span>
</span><span id="__span-35-261"><a id="__codelineno-35-261" name="__codelineno-35-261" href="#__codelineno-35-261"></a>        <span class="p">}</span>
</span><span id="__span-35-262"><a id="__codelineno-35-262" name="__codelineno-35-262" href="#__codelineno-35-262"></a>    <span class="p">}</span>
</span><span id="__span-35-263"><a id="__codelineno-35-263" name="__codelineno-35-263" href="#__codelineno-35-263"></a>
</span><span id="__span-35-264"><a id="__codelineno-35-264" name="__codelineno-35-264" href="#__codelineno-35-264"></a>    <span class="nv">$base</span> <span class="p">=</span> <span class="nv">$Email</span> <span class="o">-replace</span> <span class="s2">"@.*"</span>
</span><span id="__span-35-265"><a id="__codelineno-35-265" name="__codelineno-35-265" href="#__codelineno-35-265"></a>    <span class="nv">$similar</span> <span class="p">=</span> <span class="nb">Get-Recipient</span> <span class="n">-Filter</span> <span class="s2">"EmailAddresses -like '*$base*'"</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span>
</span><span id="__span-35-266"><a id="__codelineno-35-266" name="__codelineno-35-266" href="#__codelineno-35-266"></a>        <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="o">-ne</span> <span class="nv">$Email</span><span class="p">}</span>
</span><span id="__span-35-267"><a id="__codelineno-35-267" name="__codelineno-35-267" href="#__codelineno-35-267"></a>
</span><span id="__span-35-268"><a id="__codelineno-35-268" name="__codelineno-35-268" href="#__codelineno-35-268"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$similar</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-269"><a id="__codelineno-35-269" name="__codelineno-35-269" href="#__codelineno-35-269"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">SIMILAR ADDRESSES:"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-270"><a id="__codelineno-35-270" name="__codelineno-35-270" href="#__codelineno-35-270"></a>        <span class="nv">$similar</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-35-271"><a id="__codelineno-35-271" name="__codelineno-35-271" href="#__codelineno-35-271"></a>            <span class="nb">Write-Host</span> <span class="s2">"  </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span><span class="p">)</span><span class="s2"> - </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">RecipientTypeDetails</span><span class="p">)</span><span class="s2">"</span>
</span><span id="__span-35-272"><a id="__codelineno-35-272" name="__codelineno-35-272" href="#__codelineno-35-272"></a>        <span class="p">}</span>
</span><span id="__span-35-273"><a id="__codelineno-35-273" name="__codelineno-35-273" href="#__codelineno-35-273"></a>    <span class="p">}</span>
</span><span id="__span-35-274"><a id="__codelineno-35-274" name="__codelineno-35-274" href="#__codelineno-35-274"></a><span class="p">}</span>
</span><span id="__span-35-275"><a id="__codelineno-35-275" name="__codelineno-35-275" href="#__codelineno-35-275"></a>
</span><span id="__span-35-276"><a id="__codelineno-35-276" name="__codelineno-35-276" href="#__codelineno-35-276"></a><span class="k">function</span> <span class="n">Check-MailboxPerms</span> <span class="p">{</span>
</span><span id="__span-35-277"><a id="__codelineno-35-277" name="__codelineno-35-277" href="#__codelineno-35-277"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$Mailbox</span><span class="p">)</span>
</span><span id="__span-35-278"><a id="__codelineno-35-278" name="__codelineno-35-278" href="#__codelineno-35-278"></a>
</span><span id="__span-35-279"><a id="__codelineno-35-279" name="__codelineno-35-279" href="#__codelineno-35-279"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== MAILBOX PERMISSIONS FOR: $Mailbox ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-280"><a id="__codelineno-35-280" name="__codelineno-35-280" href="#__codelineno-35-280"></a>
</span><span id="__span-35-281"><a id="__codelineno-35-281" name="__codelineno-35-281" href="#__codelineno-35-281"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Full Access:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-282"><a id="__codelineno-35-282" name="__codelineno-35-282" href="#__codelineno-35-282"></a>    <span class="nb">Get-MailboxPermission</span> <span class="nv">$Mailbox</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> 
</span><span id="__span-35-283"><a id="__codelineno-35-283" name="__codelineno-35-283" href="#__codelineno-35-283"></a>        <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">User</span> <span class="o">-notlike</span> <span class="s2">"NT AUTHORITY*"</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">User</span> <span class="o">-notlike</span> <span class="s2">"S-1-5-*"</span><span class="p">}</span> <span class="p">|</span> 
</span><span id="__span-35-284"><a id="__codelineno-35-284" name="__codelineno-35-284" href="#__codelineno-35-284"></a>        <span class="nb">FT </span><span class="n">User</span><span class="p">,</span><span class="n">AccessRights</span> <span class="n">-AutoSize</span>
</span><span id="__span-35-285"><a id="__codelineno-35-285" name="__codelineno-35-285" href="#__codelineno-35-285"></a>
</span><span id="__span-35-286"><a id="__codelineno-35-286" name="__codelineno-35-286" href="#__codelineno-35-286"></a>    <span class="nb">Write-Host</span> <span class="s2">"Send As:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-287"><a id="__codelineno-35-287" name="__codelineno-35-287" href="#__codelineno-35-287"></a>    <span class="nb">Get-RecipientPermission</span> <span class="nv">$Mailbox</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> 
</span><span id="__span-35-288"><a id="__codelineno-35-288" name="__codelineno-35-288" href="#__codelineno-35-288"></a>        <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Trustee</span> <span class="o">-notlike</span> <span class="s2">"NT AUTHORITY*"</span><span class="p">}</span> <span class="p">|</span> 
</span><span id="__span-35-289"><a id="__codelineno-35-289" name="__codelineno-35-289" href="#__codelineno-35-289"></a>        <span class="nb">FT </span><span class="n">Trustee</span><span class="p">,</span><span class="n">AccessRights</span> <span class="n">-AutoSize</span>
</span><span id="__span-35-290"><a id="__codelineno-35-290" name="__codelineno-35-290" href="#__codelineno-35-290"></a><span class="p">}</span>
</span><span id="__span-35-291"><a id="__codelineno-35-291" name="__codelineno-35-291" href="#__codelineno-35-291"></a>
</span><span id="__span-35-292"><a id="__codelineno-35-292" name="__codelineno-35-292" href="#__codelineno-35-292"></a><span class="k">function</span> <span class="n">Check-GroupMembers</span> <span class="p">{</span>
</span><span id="__span-35-293"><a id="__codelineno-35-293" name="__codelineno-35-293" href="#__codelineno-35-293"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$Group</span><span class="p">)</span>
</span><span id="__span-35-294"><a id="__codelineno-35-294" name="__codelineno-35-294" href="#__codelineno-35-294"></a>
</span><span id="__span-35-295"><a id="__codelineno-35-295" name="__codelineno-35-295" href="#__codelineno-35-295"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== MEMBERS OF: $Group ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-296"><a id="__codelineno-35-296" name="__codelineno-35-296" href="#__codelineno-35-296"></a>
</span><span id="__span-35-297"><a id="__codelineno-35-297" name="__codelineno-35-297" href="#__codelineno-35-297"></a>    <span class="nv">$g</span> <span class="p">=</span> <span class="nb">Get-DistributionGroup</span> <span class="nv">$Group</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-298"><a id="__codelineno-35-298" name="__codelineno-35-298" href="#__codelineno-35-298"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$g</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-299"><a id="__codelineno-35-299" name="__codelineno-35-299" href="#__codelineno-35-299"></a>        <span class="nb">Write-Host</span> <span class="s2">"Group Type: </span><span class="p">$(</span><span class="nv">$g</span><span class="p">.</span><span class="n">RecipientTypeDetails</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-300"><a id="__codelineno-35-300" name="__codelineno-35-300" href="#__codelineno-35-300"></a>        <span class="nb">Write-Host</span> <span class="s2">"Member Count: </span><span class="p">$(</span><span class="nv">$g</span><span class="p">.</span><span class="n">MemberCount</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-301"><a id="__codelineno-35-301" name="__codelineno-35-301" href="#__codelineno-35-301"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Members:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-302"><a id="__codelineno-35-302" name="__codelineno-35-302" href="#__codelineno-35-302"></a>        <span class="nb">Get-DistributionGroupMember</span> <span class="nv">$Group</span> <span class="p">|</span> <span class="nb">FT </span><span class="n">Name</span><span class="p">,</span><span class="n">PrimarySmtpAddress</span> <span class="n">-AutoSize</span>
</span><span id="__span-35-303"><a id="__codelineno-35-303" name="__codelineno-35-303" href="#__codelineno-35-303"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-304"><a id="__codelineno-35-304" name="__codelineno-35-304" href="#__codelineno-35-304"></a>        <span class="nb">Write-Host</span> <span class="s2">"Group not found"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-305"><a id="__codelineno-35-305" name="__codelineno-35-305" href="#__codelineno-35-305"></a>    <span class="p">}</span>
</span><span id="__span-35-306"><a id="__codelineno-35-306" name="__codelineno-35-306" href="#__codelineno-35-306"></a><span class="p">}</span>
</span><span id="__span-35-307"><a id="__codelineno-35-307" name="__codelineno-35-307" href="#__codelineno-35-307"></a>
</span><span id="__span-35-308"><a id="__codelineno-35-308" name="__codelineno-35-308" href="#__codelineno-35-308"></a><span class="k">function</span> <span class="nb">Find-UserMemberships</span> <span class="p">{</span>
</span><span id="__span-35-309"><a id="__codelineno-35-309" name="__codelineno-35-309" href="#__codelineno-35-309"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$User</span><span class="p">)</span>
</span><span id="__span-35-310"><a id="__codelineno-35-310" name="__codelineno-35-310" href="#__codelineno-35-310"></a>
</span><span id="__span-35-311"><a id="__codelineno-35-311" name="__codelineno-35-311" href="#__codelineno-35-311"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== FINDING MEMBERSHIPS FOR: $User ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-312"><a id="__codelineno-35-312" name="__codelineno-35-312" href="#__codelineno-35-312"></a>
</span><span id="__span-35-313"><a id="__codelineno-35-313" name="__codelineno-35-313" href="#__codelineno-35-313"></a>    <span class="nv">$mailbox</span> <span class="p">=</span> <span class="nb">Get-Mailbox</span> <span class="nv">$User</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-314"><a id="__codelineno-35-314" name="__codelineno-35-314" href="#__codelineno-35-314"></a>    <span class="k">if</span> <span class="p">(!</span><span class="nv">$mailbox</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-315"><a id="__codelineno-35-315" name="__codelineno-35-315" href="#__codelineno-35-315"></a>        <span class="nb">Write-Host</span> <span class="s2">"User not found"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-316"><a id="__codelineno-35-316" name="__codelineno-35-316" href="#__codelineno-35-316"></a>        <span class="k">return</span>
</span><span id="__span-35-317"><a id="__codelineno-35-317" name="__codelineno-35-317" href="#__codelineno-35-317"></a>    <span class="p">}</span>
</span><span id="__span-35-318"><a id="__codelineno-35-318" name="__codelineno-35-318" href="#__codelineno-35-318"></a>
</span><span id="__span-35-319"><a id="__codelineno-35-319" name="__codelineno-35-319" href="#__codelineno-35-319"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">User: </span><span class="p">$(</span><span class="nv">$mailbox</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">)</span><span class="s2"> (</span><span class="p">$(</span><span class="nv">$mailbox</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span><span class="p">)</span><span class="s2">)"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-320"><a id="__codelineno-35-320" name="__codelineno-35-320" href="#__codelineno-35-320"></a>
</span><span id="__span-35-321"><a id="__codelineno-35-321" name="__codelineno-35-321" href="#__codelineno-35-321"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Distribution Groups (checking DPSS groups only):"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-322"><a id="__codelineno-35-322" name="__codelineno-35-322" href="#__codelineno-35-322"></a>    <span class="nv">$dpssGroups</span> <span class="p">=</span> <span class="nb">Get-DistributionGroup</span> <span class="s2">"*DPSS*"</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-323"><a id="__codelineno-35-323" name="__codelineno-35-323" href="#__codelineno-35-323"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$group</span> <span class="k">in</span> <span class="nv">$dpssGroups</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-324"><a id="__codelineno-35-324" name="__codelineno-35-324" href="#__codelineno-35-324"></a>        <span class="nv">$member</span> <span class="p">=</span> <span class="nb">Get-DistributionGroupMember</span> <span class="nv">$group</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> 
</span><span id="__span-35-325"><a id="__codelineno-35-325" name="__codelineno-35-325" href="#__codelineno-35-325"></a>            <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="o">-eq</span> <span class="nv">$mailbox</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span><span class="p">}</span>
</span><span id="__span-35-326"><a id="__codelineno-35-326" name="__codelineno-35-326" href="#__codelineno-35-326"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$member</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-327"><a id="__codelineno-35-327" name="__codelineno-35-327" href="#__codelineno-35-327"></a>            <span class="nb">Write-Host</span> <span class="s2">"  ✓ </span><span class="p">$(</span><span class="nv">$group</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">)</span><span class="s2"> - </span><span class="p">$(</span><span class="nv">$group</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-328"><a id="__codelineno-35-328" name="__codelineno-35-328" href="#__codelineno-35-328"></a>        <span class="p">}</span>
</span><span id="__span-35-329"><a id="__codelineno-35-329" name="__codelineno-35-329" href="#__codelineno-35-329"></a>    <span class="p">}</span>
</span><span id="__span-35-330"><a id="__codelineno-35-330" name="__codelineno-35-330" href="#__codelineno-35-330"></a>
</span><span id="__span-35-331"><a id="__codelineno-35-331" name="__codelineno-35-331" href="#__codelineno-35-331"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Microsoft 365 Groups (DPSS only):"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-332"><a id="__codelineno-35-332" name="__codelineno-35-332" href="#__codelineno-35-332"></a>    <span class="nv">$m365Groups</span> <span class="p">=</span> <span class="nb">Get-UnifiedGroup</span> <span class="s2">"*DPSS*"</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-333"><a id="__codelineno-35-333" name="__codelineno-35-333" href="#__codelineno-35-333"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$group</span> <span class="k">in</span> <span class="nv">$m365Groups</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-334"><a id="__codelineno-35-334" name="__codelineno-35-334" href="#__codelineno-35-334"></a>        <span class="nv">$member</span> <span class="p">=</span> <span class="nb">Get-UnifiedGroupLinks</span> <span class="n">-Identity</span> <span class="nv">$group</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="n">-LinkType</span> <span class="n">Members</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> 
</span><span id="__span-35-335"><a id="__codelineno-35-335" name="__codelineno-35-335" href="#__codelineno-35-335"></a>            <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="o">-eq</span> <span class="nv">$mailbox</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span><span class="p">}</span>
</span><span id="__span-35-336"><a id="__codelineno-35-336" name="__codelineno-35-336" href="#__codelineno-35-336"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$member</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-337"><a id="__codelineno-35-337" name="__codelineno-35-337" href="#__codelineno-35-337"></a>            <span class="nb">Write-Host</span> <span class="s2">"  ✓ </span><span class="p">$(</span><span class="nv">$group</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">)</span><span class="s2"> - </span><span class="p">$(</span><span class="nv">$group</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-338"><a id="__codelineno-35-338" name="__codelineno-35-338" href="#__codelineno-35-338"></a>        <span class="p">}</span>
</span><span id="__span-35-339"><a id="__codelineno-35-339" name="__codelineno-35-339" href="#__codelineno-35-339"></a>    <span class="p">}</span>
</span><span id="__span-35-340"><a id="__codelineno-35-340" name="__codelineno-35-340" href="#__codelineno-35-340"></a>
</span><span id="__span-35-341"><a id="__codelineno-35-341" name="__codelineno-35-341" href="#__codelineno-35-341"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Shared Mailbox Access (checking common DPSS mailboxes):"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-342"><a id="__codelineno-35-342" name="__codelineno-35-342" href="#__codelineno-35-342"></a>    <span class="nv">$commonMailboxes</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">"SSPDS@rivco.org"</span><span class="p">,</span> <span class="s2">"APS-CRIS@rivco.org"</span><span class="p">,</span> <span class="s2">"DPSS-All@rivco.org"</span><span class="p">)</span>
</span><span id="__span-35-343"><a id="__codelineno-35-343" name="__codelineno-35-343" href="#__codelineno-35-343"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$mbx</span> <span class="k">in</span> <span class="nv">$commonMailboxes</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-344"><a id="__codelineno-35-344" name="__codelineno-35-344" href="#__codelineno-35-344"></a>        <span class="nv">$perms</span> <span class="p">=</span> <span class="nb">Get-MailboxPermission</span> <span class="nv">$mbx</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> 
</span><span id="__span-35-345"><a id="__codelineno-35-345" name="__codelineno-35-345" href="#__codelineno-35-345"></a>            <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">User</span> <span class="o">-like</span> <span class="s2">"*</span><span class="p">$(</span><span class="nv">$mailbox</span><span class="p">.</span><span class="k">Alias</span><span class="p">)</span><span class="s2">*"</span><span class="p">}</span>
</span><span id="__span-35-346"><a id="__codelineno-35-346" name="__codelineno-35-346" href="#__codelineno-35-346"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$perms</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-347"><a id="__codelineno-35-347" name="__codelineno-35-347" href="#__codelineno-35-347"></a>            <span class="nb">Write-Host</span> <span class="s2">"  ✓ $mbx [</span><span class="p">$(</span><span class="nv">$perms</span><span class="p">.</span><span class="n">AccessRights</span> <span class="n">-join</span> <span class="s1">','</span><span class="p">)</span><span class="s2">]"</span> <span class="n">-ForegroundColor</span> <span class="n">Magenta</span>
</span><span id="__span-35-348"><a id="__codelineno-35-348" name="__codelineno-35-348" href="#__codelineno-35-348"></a>        <span class="p">}</span>
</span><span id="__span-35-349"><a id="__codelineno-35-349" name="__codelineno-35-349" href="#__codelineno-35-349"></a>    <span class="p">}</span>
</span><span id="__span-35-350"><a id="__codelineno-35-350" name="__codelineno-35-350" href="#__codelineno-35-350"></a><span class="p">}</span>
</span><span id="__span-35-351"><a id="__codelineno-35-351" name="__codelineno-35-351" href="#__codelineno-35-351"></a>
</span><span id="__span-35-352"><a id="__codelineno-35-352" name="__codelineno-35-352" href="#__codelineno-35-352"></a><span class="k">function</span> <span class="nb">Trace-Email</span> <span class="p">{</span>
</span><span id="__span-35-353"><a id="__codelineno-35-353" name="__codelineno-35-353" href="#__codelineno-35-353"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-354"><a id="__codelineno-35-354" name="__codelineno-35-354" href="#__codelineno-35-354"></a>        <span class="no">[string]</span><span class="nv">$Sender</span><span class="p">,</span>
</span><span id="__span-35-355"><a id="__codelineno-35-355" name="__codelineno-35-355" href="#__codelineno-35-355"></a>        <span class="no">[string]</span><span class="nv">$Recipient</span><span class="p">,</span>
</span><span id="__span-35-356"><a id="__codelineno-35-356" name="__codelineno-35-356" href="#__codelineno-35-356"></a>        <span class="no">[int]</span><span class="nv">$Days</span> <span class="p">=</span> <span class="n">7</span>
</span><span id="__span-35-357"><a id="__codelineno-35-357" name="__codelineno-35-357" href="#__codelineno-35-357"></a>    <span class="p">)</span>
</span><span id="__span-35-358"><a id="__codelineno-35-358" name="__codelineno-35-358" href="#__codelineno-35-358"></a>
</span><span id="__span-35-359"><a id="__codelineno-35-359" name="__codelineno-35-359" href="#__codelineno-35-359"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== MESSAGE TRACE (Last $Days days) ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-360"><a id="__codelineno-35-360" name="__codelineno-35-360" href="#__codelineno-35-360"></a>
</span><span id="__span-35-361"><a id="__codelineno-35-361" name="__codelineno-35-361" href="#__codelineno-35-361"></a>    <span class="nv">$params</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-35-362"><a id="__codelineno-35-362" name="__codelineno-35-362" href="#__codelineno-35-362"></a>        <span class="n">StartDate</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddDays</span><span class="p">(-</span><span class="nv">$Days</span><span class="p">)</span>
</span><span id="__span-35-363"><a id="__codelineno-35-363" name="__codelineno-35-363" href="#__codelineno-35-363"></a>        <span class="n">EndDate</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">)</span>
</span><span id="__span-35-364"><a id="__codelineno-35-364" name="__codelineno-35-364" href="#__codelineno-35-364"></a>    <span class="p">}</span>
</span><span id="__span-35-365"><a id="__codelineno-35-365" name="__codelineno-35-365" href="#__codelineno-35-365"></a>
</span><span id="__span-35-366"><a id="__codelineno-35-366" name="__codelineno-35-366" href="#__codelineno-35-366"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$Sender</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$params</span><span class="p">.</span><span class="n">SenderAddress</span> <span class="p">=</span> <span class="nv">$Sender</span> <span class="p">}</span>
</span><span id="__span-35-367"><a id="__codelineno-35-367" name="__codelineno-35-367" href="#__codelineno-35-367"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$Recipient</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$params</span><span class="p">.</span><span class="n">RecipientAddress</span> <span class="p">=</span> <span class="nv">$Recipient</span> <span class="p">}</span>
</span><span id="__span-35-368"><a id="__codelineno-35-368" name="__codelineno-35-368" href="#__codelineno-35-368"></a>
</span><span id="__span-35-369"><a id="__codelineno-35-369" name="__codelineno-35-369" href="#__codelineno-35-369"></a>    <span class="nb">Get-MessageTrace</span> <span class="nv">@params</span> <span class="p">|</span>
</span><span id="__span-35-370"><a id="__codelineno-35-370" name="__codelineno-35-370" href="#__codelineno-35-370"></a>        <span class="nb">Sort-Object</span> <span class="n">Received</span> <span class="n">-Descending</span> <span class="p">|</span>
</span><span id="__span-35-371"><a id="__codelineno-35-371" name="__codelineno-35-371" href="#__codelineno-35-371"></a>        <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">20</span> <span class="p">|</span>
</span><span id="__span-35-372"><a id="__codelineno-35-372" name="__codelineno-35-372" href="#__codelineno-35-372"></a>        <span class="nb">FT </span><span class="n">Received</span><span class="p">,</span><span class="n">SenderAddress</span><span class="p">,</span><span class="n">RecipientAddress</span><span class="p">,</span><span class="n">Subject</span><span class="p">,</span><span class="n">Status</span> <span class="n">-AutoSize</span>
</span><span id="__span-35-373"><a id="__codelineno-35-373" name="__codelineno-35-373" href="#__codelineno-35-373"></a><span class="p">}</span>
</span><span id="__span-35-374"><a id="__codelineno-35-374" name="__codelineno-35-374" href="#__codelineno-35-374"></a>
</span><span id="__span-35-375"><a id="__codelineno-35-375" name="__codelineno-35-375" href="#__codelineno-35-375"></a><span class="k">function</span> <span class="nb">Trace-AutoReply</span> <span class="p">{</span>
</span><span id="__span-35-376"><a id="__codelineno-35-376" name="__codelineno-35-376" href="#__codelineno-35-376"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-377"><a id="__codelineno-35-377" name="__codelineno-35-377" href="#__codelineno-35-377"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-378"><a id="__codelineno-35-378" name="__codelineno-35-378" href="#__codelineno-35-378"></a>        <span class="no">[string]</span><span class="nv">$User</span><span class="p">,</span>
</span><span id="__span-35-379"><a id="__codelineno-35-379" name="__codelineno-35-379" href="#__codelineno-35-379"></a>        <span class="no">[int]</span><span class="nv">$Days</span> <span class="p">=</span> <span class="n">10</span>
</span><span id="__span-35-380"><a id="__codelineno-35-380" name="__codelineno-35-380" href="#__codelineno-35-380"></a>    <span class="p">)</span>
</span><span id="__span-35-381"><a id="__codelineno-35-381" name="__codelineno-35-381" href="#__codelineno-35-381"></a>
</span><span id="__span-35-382"><a id="__codelineno-35-382" name="__codelineno-35-382" href="#__codelineno-35-382"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== AUTO-REPLIES FROM: $User ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-383"><a id="__codelineno-35-383" name="__codelineno-35-383" href="#__codelineno-35-383"></a>
</span><span id="__span-35-384"><a id="__codelineno-35-384" name="__codelineno-35-384" href="#__codelineno-35-384"></a>    <span class="nb">Get-MessageTrace</span> <span class="n">-SenderAddress</span> <span class="nv">$User</span> <span class="n">-StartDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddDays</span><span class="p">(-</span><span class="nv">$Days</span><span class="p">)</span> <span class="n">-EndDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">)</span> <span class="p">|</span>
</span><span id="__span-35-385"><a id="__codelineno-35-385" name="__codelineno-35-385" href="#__codelineno-35-385"></a>        <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Subject</span> <span class="o">-like</span> <span class="s2">"*Automatic reply*"</span> <span class="o">-or</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Subject</span> <span class="o">-like</span> <span class="s2">"*Out of Office*"</span> <span class="o">-or</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Subject</span> <span class="o">-like</span> <span class="s2">"*Away*"</span><span class="p">}</span> <span class="p">|</span>
</span><span id="__span-35-386"><a id="__codelineno-35-386" name="__codelineno-35-386" href="#__codelineno-35-386"></a>        <span class="nb">Sort-Object</span> <span class="n">Received</span> <span class="n">-Descending</span> <span class="p">|</span>
</span><span id="__span-35-387"><a id="__codelineno-35-387" name="__codelineno-35-387" href="#__codelineno-35-387"></a>        <span class="nb">FT </span><span class="n">Received</span><span class="p">,</span><span class="n">RecipientAddress</span><span class="p">,</span><span class="n">Subject</span><span class="p">,</span><span class="n">Status</span> <span class="n">-AutoSize</span>
</span><span id="__span-35-388"><a id="__codelineno-35-388" name="__codelineno-35-388" href="#__codelineno-35-388"></a><span class="p">}</span>
</span><span id="__span-35-389"><a id="__codelineno-35-389" name="__codelineno-35-389" href="#__codelineno-35-389"></a>
</span><span id="__span-35-390"><a id="__codelineno-35-390" name="__codelineno-35-390" href="#__codelineno-35-390"></a><span class="k">function</span> <span class="nb">Add-UserToGroup</span> <span class="p">{</span>
</span><span id="__span-35-391"><a id="__codelineno-35-391" name="__codelineno-35-391" href="#__codelineno-35-391"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-392"><a id="__codelineno-35-392" name="__codelineno-35-392" href="#__codelineno-35-392"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-393"><a id="__codelineno-35-393" name="__codelineno-35-393" href="#__codelineno-35-393"></a>        <span class="no">[string]</span><span class="nv">$User</span><span class="p">,</span>
</span><span id="__span-35-394"><a id="__codelineno-35-394" name="__codelineno-35-394" href="#__codelineno-35-394"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-395"><a id="__codelineno-35-395" name="__codelineno-35-395" href="#__codelineno-35-395"></a>        <span class="no">[string]</span><span class="nv">$Group</span>
</span><span id="__span-35-396"><a id="__codelineno-35-396" name="__codelineno-35-396" href="#__codelineno-35-396"></a>    <span class="p">)</span>
</span><span id="__span-35-397"><a id="__codelineno-35-397" name="__codelineno-35-397" href="#__codelineno-35-397"></a>
</span><span id="__span-35-398"><a id="__codelineno-35-398" name="__codelineno-35-398" href="#__codelineno-35-398"></a>    <span class="nb">Add-DistributionGroupMember</span> <span class="n">-Identity</span> <span class="nv">$Group</span> <span class="n">-Member</span> <span class="nv">$User</span>
</span><span id="__span-35-399"><a id="__codelineno-35-399" name="__codelineno-35-399" href="#__codelineno-35-399"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">✅ Added $User to $Group"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-400"><a id="__codelineno-35-400" name="__codelineno-35-400" href="#__codelineno-35-400"></a>
</span><span id="__span-35-401"><a id="__codelineno-35-401" name="__codelineno-35-401" href="#__codelineno-35-401"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Verifying..."</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-402"><a id="__codelineno-35-402" name="__codelineno-35-402" href="#__codelineno-35-402"></a>    <span class="nb">Get-DistributionGroupMember</span> <span class="nv">$Group</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">PrimarySmtpAddress</span> <span class="o">-like</span> <span class="s2">"*$User*"</span><span class="p">}</span> <span class="p">|</span> <span class="nb">FT </span><span class="n">Name</span><span class="p">,</span><span class="n">PrimarySmtpAddress</span>
</span><span id="__span-35-403"><a id="__codelineno-35-403" name="__codelineno-35-403" href="#__codelineno-35-403"></a><span class="p">}</span>
</span><span id="__span-35-404"><a id="__codelineno-35-404" name="__codelineno-35-404" href="#__codelineno-35-404"></a>
</span><span id="__span-35-405"><a id="__codelineno-35-405" name="__codelineno-35-405" href="#__codelineno-35-405"></a><span class="k">function</span> <span class="nb">Get-WhoChanged</span> <span class="p">{</span>
</span><span id="__span-35-406"><a id="__codelineno-35-406" name="__codelineno-35-406" href="#__codelineno-35-406"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-407"><a id="__codelineno-35-407" name="__codelineno-35-407" href="#__codelineno-35-407"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-408"><a id="__codelineno-35-408" name="__codelineno-35-408" href="#__codelineno-35-408"></a>        <span class="no">[string]</span><span class="nv">$ObjectId</span><span class="p">,</span>
</span><span id="__span-35-409"><a id="__codelineno-35-409" name="__codelineno-35-409" href="#__codelineno-35-409"></a>        <span class="no">[int]</span><span class="nv">$Days</span> <span class="p">=</span> <span class="n">30</span>
</span><span id="__span-35-410"><a id="__codelineno-35-410" name="__codelineno-35-410" href="#__codelineno-35-410"></a>    <span class="p">)</span>
</span><span id="__span-35-411"><a id="__codelineno-35-411" name="__codelineno-35-411" href="#__codelineno-35-411"></a>
</span><span id="__span-35-412"><a id="__codelineno-35-412" name="__codelineno-35-412" href="#__codelineno-35-412"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== AUDIT LOG FOR: $ObjectId ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-413"><a id="__codelineno-35-413" name="__codelineno-35-413" href="#__codelineno-35-413"></a>
</span><span id="__span-35-414"><a id="__codelineno-35-414" name="__codelineno-35-414" href="#__codelineno-35-414"></a>    <span class="nb">Search-UnifiedAuditLog</span> <span class="n">-StartDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddDays</span><span class="p">(-</span><span class="nv">$Days</span><span class="p">)</span> <span class="n">-EndDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">)</span> <span class="n">-FreeText</span> <span class="nv">$ObjectId</span> <span class="n">-RecordType</span> <span class="n">ExchangeAdmin</span> <span class="n">-ResultSize</span> <span class="n">100</span> <span class="p">|</span> 
</span><span id="__span-35-415"><a id="__codelineno-35-415" name="__codelineno-35-415" href="#__codelineno-35-415"></a>        <span class="nb">Select-Object</span> <span class="n">CreationDate</span><span class="p">,</span><span class="n">UserIds</span><span class="p">,</span><span class="n">Operations</span> <span class="p">|</span> 
</span><span id="__span-35-416"><a id="__codelineno-35-416" name="__codelineno-35-416" href="#__codelineno-35-416"></a>        <span class="nb">Sort-Object</span> <span class="n">CreationDate</span> <span class="n">-Descending</span> <span class="p">|</span> 
</span><span id="__span-35-417"><a id="__codelineno-35-417" name="__codelineno-35-417" href="#__codelineno-35-417"></a>        <span class="nb">FT </span><span class="n">-AutoSize</span>
</span><span id="__span-35-418"><a id="__codelineno-35-418" name="__codelineno-35-418" href="#__codelineno-35-418"></a><span class="p">}</span>
</span><span id="__span-35-419"><a id="__codelineno-35-419" name="__codelineno-35-419" href="#__codelineno-35-419"></a>
</span><span id="__span-35-420"><a id="__codelineno-35-420" name="__codelineno-35-420" href="#__codelineno-35-420"></a><span class="k">function</span> <span class="n">Check-MobileDevices</span> <span class="p">{</span>
</span><span id="__span-35-421"><a id="__codelineno-35-421" name="__codelineno-35-421" href="#__codelineno-35-421"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$User</span><span class="p">)</span>
</span><span id="__span-35-422"><a id="__codelineno-35-422" name="__codelineno-35-422" href="#__codelineno-35-422"></a>
</span><span id="__span-35-423"><a id="__codelineno-35-423" name="__codelineno-35-423" href="#__codelineno-35-423"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== MOBILE DEVICES FOR: $User ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-424"><a id="__codelineno-35-424" name="__codelineno-35-424" href="#__codelineno-35-424"></a>
</span><span id="__span-35-425"><a id="__codelineno-35-425" name="__codelineno-35-425" href="#__codelineno-35-425"></a>    <span class="nb">Get-MobileDevice</span> <span class="n">-Mailbox</span> <span class="nv">$User</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="p">|</span> 
</span><span id="__span-35-426"><a id="__codelineno-35-426" name="__codelineno-35-426" href="#__codelineno-35-426"></a>        <span class="nb">FT </span><span class="n">FriendlyName</span><span class="p">,</span><span class="n">DeviceModel</span><span class="p">,</span><span class="n">DeviceOS</span><span class="p">,</span><span class="n">FirstSyncTime</span><span class="p">,</span><span class="n">LastSuccessSync</span> <span class="n">-AutoSize</span>
</span><span id="__span-35-427"><a id="__codelineno-35-427" name="__codelineno-35-427" href="#__codelineno-35-427"></a><span class="p">}</span>
</span><span id="__span-35-428"><a id="__codelineno-35-428" name="__codelineno-35-428" href="#__codelineno-35-428"></a>
</span><span id="__span-35-429"><a id="__codelineno-35-429" name="__codelineno-35-429" href="#__codelineno-35-429"></a><span class="k">function</span> <span class="nb">Grant-TempAccess</span> <span class="p">{</span>
</span><span id="__span-35-430"><a id="__codelineno-35-430" name="__codelineno-35-430" href="#__codelineno-35-430"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-431"><a id="__codelineno-35-431" name="__codelineno-35-431" href="#__codelineno-35-431"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-432"><a id="__codelineno-35-432" name="__codelineno-35-432" href="#__codelineno-35-432"></a>        <span class="no">[string]</span><span class="nv">$Mailbox</span><span class="p">,</span>
</span><span id="__span-35-433"><a id="__codelineno-35-433" name="__codelineno-35-433" href="#__codelineno-35-433"></a>        <span class="no">[string]</span><span class="nv">$User</span> <span class="p">=</span> <span class="s2">"$env:USERNAME@rivco.org"</span>
</span><span id="__span-35-434"><a id="__codelineno-35-434" name="__codelineno-35-434" href="#__codelineno-35-434"></a>    <span class="p">)</span>
</span><span id="__span-35-435"><a id="__codelineno-35-435" name="__codelineno-35-435" href="#__codelineno-35-435"></a>
</span><span id="__span-35-436"><a id="__codelineno-35-436" name="__codelineno-35-436" href="#__codelineno-35-436"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Granting temporary Full Access to $Mailbox..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-437"><a id="__codelineno-35-437" name="__codelineno-35-437" href="#__codelineno-35-437"></a>
</span><span id="__span-35-438"><a id="__codelineno-35-438" name="__codelineno-35-438" href="#__codelineno-35-438"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-439"><a id="__codelineno-35-439" name="__codelineno-35-439" href="#__codelineno-35-439"></a>        <span class="nb">Add-MailboxPermission</span> <span class="n">-Identity</span> <span class="nv">$Mailbox</span> <span class="n">-User</span> <span class="nv">$User</span> <span class="n">-AccessRights</span> <span class="n">FullAccess</span> <span class="n">-AutoMapping</span> <span class="nv">$false</span>
</span><span id="__span-35-440"><a id="__codelineno-35-440" name="__codelineno-35-440" href="#__codelineno-35-440"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Access granted to $User"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-441"><a id="__codelineno-35-441" name="__codelineno-35-441" href="#__codelineno-35-441"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">To access the mailbox:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-442"><a id="__codelineno-35-442" name="__codelineno-35-442" href="#__codelineno-35-442"></a>        <span class="nb">Write-Host</span> <span class="s2">"  1. Go to https://outlook.office.com"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-443"><a id="__codelineno-35-443" name="__codelineno-35-443" href="#__codelineno-35-443"></a>        <span class="nb">Write-Host</span> <span class="s2">"  2. Click profile picture &gt; Open another mailbox"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-444"><a id="__codelineno-35-444" name="__codelineno-35-444" href="#__codelineno-35-444"></a>        <span class="nb">Write-Host</span> <span class="s2">"  3. Enter: $Mailbox"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-445"><a id="__codelineno-35-445" name="__codelineno-35-445" href="#__codelineno-35-445"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Remember to remove access when done:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-446"><a id="__codelineno-35-446" name="__codelineno-35-446" href="#__codelineno-35-446"></a>        <span class="nb">Write-Host</span> <span class="s2">"  Remove-TempAccess '$Mailbox'"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-447"><a id="__codelineno-35-447" name="__codelineno-35-447" href="#__codelineno-35-447"></a>    <span class="p">}</span>
</span><span id="__span-35-448"><a id="__codelineno-35-448" name="__codelineno-35-448" href="#__codelineno-35-448"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-449"><a id="__codelineno-35-449" name="__codelineno-35-449" href="#__codelineno-35-449"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to grant access: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-450"><a id="__codelineno-35-450" name="__codelineno-35-450" href="#__codelineno-35-450"></a>    <span class="p">}</span>
</span><span id="__span-35-451"><a id="__codelineno-35-451" name="__codelineno-35-451" href="#__codelineno-35-451"></a><span class="p">}</span>
</span><span id="__span-35-452"><a id="__codelineno-35-452" name="__codelineno-35-452" href="#__codelineno-35-452"></a>
</span><span id="__span-35-453"><a id="__codelineno-35-453" name="__codelineno-35-453" href="#__codelineno-35-453"></a><span class="k">function</span> <span class="nb">Remove-TempAccess</span> <span class="p">{</span>
</span><span id="__span-35-454"><a id="__codelineno-35-454" name="__codelineno-35-454" href="#__codelineno-35-454"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-455"><a id="__codelineno-35-455" name="__codelineno-35-455" href="#__codelineno-35-455"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-456"><a id="__codelineno-35-456" name="__codelineno-35-456" href="#__codelineno-35-456"></a>        <span class="no">[string]</span><span class="nv">$Mailbox</span><span class="p">,</span>
</span><span id="__span-35-457"><a id="__codelineno-35-457" name="__codelineno-35-457" href="#__codelineno-35-457"></a>        <span class="no">[string]</span><span class="nv">$User</span> <span class="p">=</span> <span class="s2">"$env:USERNAME@rivco.org"</span>
</span><span id="__span-35-458"><a id="__codelineno-35-458" name="__codelineno-35-458" href="#__codelineno-35-458"></a>    <span class="p">)</span>
</span><span id="__span-35-459"><a id="__codelineno-35-459" name="__codelineno-35-459" href="#__codelineno-35-459"></a>
</span><span id="__span-35-460"><a id="__codelineno-35-460" name="__codelineno-35-460" href="#__codelineno-35-460"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Removing temporary Full Access from $Mailbox..."</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-461"><a id="__codelineno-35-461" name="__codelineno-35-461" href="#__codelineno-35-461"></a>
</span><span id="__span-35-462"><a id="__codelineno-35-462" name="__codelineno-35-462" href="#__codelineno-35-462"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-463"><a id="__codelineno-35-463" name="__codelineno-35-463" href="#__codelineno-35-463"></a>        <span class="nb">Remove-MailboxPermission</span> <span class="n">-Identity</span> <span class="nv">$Mailbox</span> <span class="n">-User</span> <span class="nv">$User</span> <span class="n">-AccessRights</span> <span class="n">FullAccess</span> <span class="n">-Confirm</span><span class="p">:</span><span class="nv">$false</span>
</span><span id="__span-35-464"><a id="__codelineno-35-464" name="__codelineno-35-464" href="#__codelineno-35-464"></a>        <span class="nb">Write-Host</span> <span class="s2">"✅ Access removed from $User"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-465"><a id="__codelineno-35-465" name="__codelineno-35-465" href="#__codelineno-35-465"></a>    <span class="p">}</span>
</span><span id="__span-35-466"><a id="__codelineno-35-466" name="__codelineno-35-466" href="#__codelineno-35-466"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-467"><a id="__codelineno-35-467" name="__codelineno-35-467" href="#__codelineno-35-467"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to remove access: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-468"><a id="__codelineno-35-468" name="__codelineno-35-468" href="#__codelineno-35-468"></a>    <span class="p">}</span>
</span><span id="__span-35-469"><a id="__codelineno-35-469" name="__codelineno-35-469" href="#__codelineno-35-469"></a><span class="p">}</span>
</span><span id="__span-35-470"><a id="__codelineno-35-470" name="__codelineno-35-470" href="#__codelineno-35-470"></a>
</span><span id="__span-35-471"><a id="__codelineno-35-471" name="__codelineno-35-471" href="#__codelineno-35-471"></a><span class="k">function</span> <span class="n">Fix-CalendarLoop</span> <span class="p">{</span>
</span><span id="__span-35-472"><a id="__codelineno-35-472" name="__codelineno-35-472" href="#__codelineno-35-472"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-473"><a id="__codelineno-35-473" name="__codelineno-35-473" href="#__codelineno-35-473"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-474"><a id="__codelineno-35-474" name="__codelineno-35-474" href="#__codelineno-35-474"></a>        <span class="no">[string]</span><span class="nv">$User</span>
</span><span id="__span-35-475"><a id="__codelineno-35-475" name="__codelineno-35-475" href="#__codelineno-35-475"></a>    <span class="p">)</span>
</span><span id="__span-35-476"><a id="__codelineno-35-476" name="__codelineno-35-476" href="#__codelineno-35-476"></a>
</span><span id="__span-35-477"><a id="__codelineno-35-477" name="__codelineno-35-477" href="#__codelineno-35-477"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== FIXING CALENDAR LOOP FOR: $User ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-478"><a id="__codelineno-35-478" name="__codelineno-35-478" href="#__codelineno-35-478"></a>
</span><span id="__span-35-479"><a id="__codelineno-35-479" name="__codelineno-35-479" href="#__codelineno-35-479"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Checking message trace..."</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-480"><a id="__codelineno-35-480" name="__codelineno-35-480" href="#__codelineno-35-480"></a>    <span class="nv">$messages</span> <span class="p">=</span> <span class="nb">Get-MessageTrace</span> <span class="n">-SenderAddress</span> <span class="nv">$User</span> <span class="n">-StartDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddDays</span><span class="p">(-</span><span class="n">7</span><span class="p">)</span> <span class="n">-EndDate</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">)</span> <span class="p">|</span> 
</span><span id="__span-35-481"><a id="__codelineno-35-481" name="__codelineno-35-481" href="#__codelineno-35-481"></a>        <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Subject</span> <span class="o">-like</span> <span class="s2">"*Accepted:*"</span> <span class="o">-or</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Subject</span> <span class="o">-like</span> <span class="s2">"*Tentative:*"</span> <span class="o">-or</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Subject</span> <span class="o">-like</span> <span class="s2">"*Declined:*"</span><span class="p">}</span>
</span><span id="__span-35-482"><a id="__codelineno-35-482" name="__codelineno-35-482" href="#__codelineno-35-482"></a>
</span><span id="__span-35-483"><a id="__codelineno-35-483" name="__codelineno-35-483" href="#__codelineno-35-483"></a>    <span class="nv">$grouped</span> <span class="p">=</span> <span class="nv">$messages</span> <span class="p">|</span> <span class="nb">Group-Object</span> <span class="n">Subject</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Count</span> <span class="n">-Descending</span>
</span><span id="__span-35-484"><a id="__codelineno-35-484" name="__codelineno-35-484" href="#__codelineno-35-484"></a>
</span><span id="__span-35-485"><a id="__codelineno-35-485" name="__codelineno-35-485" href="#__codelineno-35-485"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$grouped</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-486"><a id="__codelineno-35-486" name="__codelineno-35-486" href="#__codelineno-35-486"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Found calendar response loops:"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-487"><a id="__codelineno-35-487" name="__codelineno-35-487" href="#__codelineno-35-487"></a>        <span class="nv">$grouped</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Count</span><span class="p">,</span><span class="n">Name</span> <span class="p">|</span> <span class="nb">FT</span>
</span><span id="__span-35-488"><a id="__codelineno-35-488" name="__codelineno-35-488" href="#__codelineno-35-488"></a>    <span class="p">}</span>
</span><span id="__span-35-489"><a id="__codelineno-35-489" name="__codelineno-35-489" href="#__codelineno-35-489"></a>
</span><span id="__span-35-490"><a id="__codelineno-35-490" name="__codelineno-35-490" href="#__codelineno-35-490"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Mobile Devices:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-491"><a id="__codelineno-35-491" name="__codelineno-35-491" href="#__codelineno-35-491"></a>    <span class="nv">$devices</span> <span class="p">=</span> <span class="nb">Get-MobileDevice</span> <span class="n">-Mailbox</span> <span class="nv">$User</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-492"><a id="__codelineno-35-492" name="__codelineno-35-492" href="#__codelineno-35-492"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$devices</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-493"><a id="__codelineno-35-493" name="__codelineno-35-493" href="#__codelineno-35-493"></a>        <span class="nv">$devices</span> <span class="p">|</span> <span class="nb">FT </span><span class="n">FriendlyName</span><span class="p">,</span><span class="n">DeviceModel</span><span class="p">,</span><span class="n">LastSuccessSync</span>
</span><span id="__span-35-494"><a id="__codelineno-35-494" name="__codelineno-35-494" href="#__codelineno-35-494"></a>
</span><span id="__span-35-495"><a id="__codelineno-35-495" name="__codelineno-35-495" href="#__codelineno-35-495"></a>        <span class="nv">$response</span> <span class="p">=</span> <span class="nb">Read-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Remove all mobile devices? (y/n)"</span>
</span><span id="__span-35-496"><a id="__codelineno-35-496" name="__codelineno-35-496" href="#__codelineno-35-496"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span> <span class="o">-eq</span> <span class="s1">'y'</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-497"><a id="__codelineno-35-497" name="__codelineno-35-497" href="#__codelineno-35-497"></a>            <span class="nv">$devices</span> <span class="p">|</span> <span class="nb">Remove-MobileDevice</span> <span class="n">-Confirm</span><span class="p">:</span><span class="nv">$false</span>
</span><span id="__span-35-498"><a id="__codelineno-35-498" name="__codelineno-35-498" href="#__codelineno-35-498"></a>            <span class="nb">Write-Host</span> <span class="s2">"✅ Mobile devices removed. User must re-add email on devices."</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-499"><a id="__codelineno-35-499" name="__codelineno-35-499" href="#__codelineno-35-499"></a>        <span class="p">}</span>
</span><span id="__span-35-500"><a id="__codelineno-35-500" name="__codelineno-35-500" href="#__codelineno-35-500"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-35-501"><a id="__codelineno-35-501" name="__codelineno-35-501" href="#__codelineno-35-501"></a>        <span class="nb">Write-Host</span> <span class="s2">"No mobile devices found"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-502"><a id="__codelineno-35-502" name="__codelineno-35-502" href="#__codelineno-35-502"></a>    <span class="p">}</span>
</span><span id="__span-35-503"><a id="__codelineno-35-503" name="__codelineno-35-503" href="#__codelineno-35-503"></a>
</span><span id="__span-35-504"><a id="__codelineno-35-504" name="__codelineno-35-504" href="#__codelineno-35-504"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== NEXT STEPS ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-505"><a id="__codelineno-35-505" name="__codelineno-35-505" href="#__codelineno-35-505"></a>    <span class="nb">Write-Host</span> <span class="s2">"1. If devices removed, have user re-add email on all devices"</span>
</span><span id="__span-35-506"><a id="__codelineno-35-506" name="__codelineno-35-506" href="#__codelineno-35-506"></a>    <span class="nb">Write-Host</span> <span class="s2">"2. Delete the problematic calendar meeting from user's mailbox"</span>
</span><span id="__span-35-507"><a id="__codelineno-35-507" name="__codelineno-35-507" href="#__codelineno-35-507"></a>    <span class="nb">Write-Host</span> <span class="s2">"3. Monitor for 24 hours to ensure loop stopped"</span>
</span><span id="__span-35-508"><a id="__codelineno-35-508" name="__codelineno-35-508" href="#__codelineno-35-508"></a><span class="p">}</span>
</span><span id="__span-35-509"><a id="__codelineno-35-509" name="__codelineno-35-509" href="#__codelineno-35-509"></a>
</span><span id="__span-35-510"><a id="__codelineno-35-510" name="__codelineno-35-510" href="#__codelineno-35-510"></a><span class="k">function</span> <span class="nb">Add-SPOSiteUser</span> <span class="p">{</span>
</span><span id="__span-35-511"><a id="__codelineno-35-511" name="__codelineno-35-511" href="#__codelineno-35-511"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-35-512"><a id="__codelineno-35-512" name="__codelineno-35-512" href="#__codelineno-35-512"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-513"><a id="__codelineno-35-513" name="__codelineno-35-513" href="#__codelineno-35-513"></a>        <span class="no">[string]</span><span class="nv">$SiteUrl</span><span class="p">,</span>
</span><span id="__span-35-514"><a id="__codelineno-35-514" name="__codelineno-35-514" href="#__codelineno-35-514"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-515"><a id="__codelineno-35-515" name="__codelineno-35-515" href="#__codelineno-35-515"></a>        <span class="no">[string]</span><span class="nv">$User</span><span class="p">,</span>
</span><span id="__span-35-516"><a id="__codelineno-35-516" name="__codelineno-35-516" href="#__codelineno-35-516"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
</span><span id="__span-35-517"><a id="__codelineno-35-517" name="__codelineno-35-517" href="#__codelineno-35-517"></a>        <span class="p">[</span><span class="k">ValidateSet</span><span class="p">(</span><span class="s1">'Admins'</span><span class="p">,</span><span class="s1">'Owners'</span><span class="p">,</span><span class="s1">'Members'</span><span class="p">,</span><span class="s1">'Visitors'</span><span class="p">)]</span>
</span><span id="__span-35-518"><a id="__codelineno-35-518" name="__codelineno-35-518" href="#__codelineno-35-518"></a>        <span class="no">[string]</span><span class="nv">$GroupType</span>
</span><span id="__span-35-519"><a id="__codelineno-35-519" name="__codelineno-35-519" href="#__codelineno-35-519"></a>    <span class="p">)</span>
</span><span id="__span-35-520"><a id="__codelineno-35-520" name="__codelineno-35-520" href="#__codelineno-35-520"></a>
</span><span id="__span-35-521"><a id="__codelineno-35-521" name="__codelineno-35-521" href="#__codelineno-35-521"></a>    <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">=== ADDING USER TO SPO SITE GROUP ==="</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-522"><a id="__codelineno-35-522" name="__codelineno-35-522" href="#__codelineno-35-522"></a>    <span class="nb">Write-Host</span> <span class="s2">"Site: $SiteUrl"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-523"><a id="__codelineno-35-523" name="__codelineno-35-523" href="#__codelineno-35-523"></a>    <span class="nb">Write-Host</span> <span class="s2">"User: $User"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-524"><a id="__codelineno-35-524" name="__codelineno-35-524" href="#__codelineno-35-524"></a>    <span class="nb">Write-Host</span> <span class="s2">"Group: $GroupType"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-525"><a id="__codelineno-35-525" name="__codelineno-35-525" href="#__codelineno-35-525"></a>    <span class="nb">Write-Host</span> <span class="s2">""</span>
</span><span id="__span-35-526"><a id="__codelineno-35-526" name="__codelineno-35-526" href="#__codelineno-35-526"></a>
</span><span id="__span-35-527"><a id="__codelineno-35-527" name="__codelineno-35-527" href="#__codelineno-35-527"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-528"><a id="__codelineno-35-528" name="__codelineno-35-528" href="#__codelineno-35-528"></a>        <span class="c"># Check if connected to SPO</span>
</span><span id="__span-35-529"><a id="__codelineno-35-529" name="__codelineno-35-529" href="#__codelineno-35-529"></a>        <span class="nv">$spoConnection</span> <span class="p">=</span> <span class="nb">Get-SPOSite</span> <span class="n">-Limit</span> <span class="n">1</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-530"><a id="__codelineno-35-530" name="__codelineno-35-530" href="#__codelineno-35-530"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$spoConnection</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-531"><a id="__codelineno-35-531" name="__codelineno-35-531" href="#__codelineno-35-531"></a>            <span class="nb">Write-Host</span> <span class="s2">"❌ Not connected to SharePoint Online"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-532"><a id="__codelineno-35-532" name="__codelineno-35-532" href="#__codelineno-35-532"></a>            <span class="nb">Write-Host</span> <span class="s2">"Connect with: spo &lt;tenant-name&gt;"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-533"><a id="__codelineno-35-533" name="__codelineno-35-533" href="#__codelineno-35-533"></a>            <span class="k">return</span>
</span><span id="__span-35-534"><a id="__codelineno-35-534" name="__codelineno-35-534" href="#__codelineno-35-534"></a>        <span class="p">}</span>
</span><span id="__span-35-535"><a id="__codelineno-35-535" name="__codelineno-35-535" href="#__codelineno-35-535"></a>
</span><span id="__span-35-536"><a id="__codelineno-35-536" name="__codelineno-35-536" href="#__codelineno-35-536"></a>        <span class="c"># Normalize site URL</span>
</span><span id="__span-35-537"><a id="__codelineno-35-537" name="__codelineno-35-537" href="#__codelineno-35-537"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$SiteUrl</span> <span class="o">-notmatch</span> <span class="s1">'^https?://'</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-538"><a id="__codelineno-35-538" name="__codelineno-35-538" href="#__codelineno-35-538"></a>            <span class="nb">Write-Host</span> <span class="s2">"❌ Site URL must be a full URL (e.g., https://tenant.sharepoint.com/sites/sitename)"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-539"><a id="__codelineno-35-539" name="__codelineno-35-539" href="#__codelineno-35-539"></a>            <span class="k">return</span>
</span><span id="__span-35-540"><a id="__codelineno-35-540" name="__codelineno-35-540" href="#__codelineno-35-540"></a>        <span class="p">}</span>
</span><span id="__span-35-541"><a id="__codelineno-35-541" name="__codelineno-35-541" href="#__codelineno-35-541"></a>
</span><span id="__span-35-542"><a id="__codelineno-35-542" name="__codelineno-35-542" href="#__codelineno-35-542"></a>        <span class="k">switch</span> <span class="p">(</span><span class="nv">$GroupType</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-543"><a id="__codelineno-35-543" name="__codelineno-35-543" href="#__codelineno-35-543"></a>            <span class="s1">'Admins'</span> <span class="p">{</span>
</span><span id="__span-35-544"><a id="__codelineno-35-544" name="__codelineno-35-544" href="#__codelineno-35-544"></a>                <span class="nb">Write-Host</span> <span class="s2">"Adding as Site Collection Administrator..."</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-545"><a id="__codelineno-35-545" name="__codelineno-35-545" href="#__codelineno-35-545"></a>                <span class="nb">Set-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-IsSiteCollectionAdmin</span> <span class="nv">$true</span>
</span><span id="__span-35-546"><a id="__codelineno-35-546" name="__codelineno-35-546" href="#__codelineno-35-546"></a>                <span class="nb">Write-Host</span> <span class="s2">"✅ $User added as Site Collection Admin"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-547"><a id="__codelineno-35-547" name="__codelineno-35-547" href="#__codelineno-35-547"></a>            <span class="p">}</span>
</span><span id="__span-35-548"><a id="__codelineno-35-548" name="__codelineno-35-548" href="#__codelineno-35-548"></a>            <span class="s1">'Owners'</span> <span class="p">{</span>
</span><span id="__span-35-549"><a id="__codelineno-35-549" name="__codelineno-35-549" href="#__codelineno-35-549"></a>                <span class="nb">Write-Host</span> <span class="s2">"Adding to Site Owners group..."</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-550"><a id="__codelineno-35-550" name="__codelineno-35-550" href="#__codelineno-35-550"></a>                <span class="nv">$site</span> <span class="p">=</span> <span class="nb">Get-SPOSite</span> <span class="n">-Identity</span> <span class="nv">$SiteUrl</span>
</span><span id="__span-35-551"><a id="__codelineno-35-551" name="__codelineno-35-551" href="#__codelineno-35-551"></a>                <span class="nv">$groupName</span> <span class="p">=</span> <span class="s2">"</span><span class="p">$(</span><span class="nv">$site</span><span class="p">.</span><span class="n">Title</span><span class="p">)</span><span class="s2"> Owners"</span>
</span><span id="__span-35-552"><a id="__codelineno-35-552" name="__codelineno-35-552" href="#__codelineno-35-552"></a>                <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-553"><a id="__codelineno-35-553" name="__codelineno-35-553" href="#__codelineno-35-553"></a>                    <span class="nb">Add-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-Group</span> <span class="nv">$groupName</span>
</span><span id="__span-35-554"><a id="__codelineno-35-554" name="__codelineno-35-554" href="#__codelineno-35-554"></a>                    <span class="nb">Write-Host</span> <span class="s2">"✅ $User added to Owners group"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-555"><a id="__codelineno-35-555" name="__codelineno-35-555" href="#__codelineno-35-555"></a>                <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-556"><a id="__codelineno-35-556" name="__codelineno-35-556" href="#__codelineno-35-556"></a>                    <span class="c"># Fallback: try generic group name</span>
</span><span id="__span-35-557"><a id="__codelineno-35-557" name="__codelineno-35-557" href="#__codelineno-35-557"></a>                    <span class="nb">Add-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-Group</span> <span class="s2">"Owners"</span>
</span><span id="__span-35-558"><a id="__codelineno-35-558" name="__codelineno-35-558" href="#__codelineno-35-558"></a>                    <span class="nb">Write-Host</span> <span class="s2">"✅ $User added to Owners group"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-559"><a id="__codelineno-35-559" name="__codelineno-35-559" href="#__codelineno-35-559"></a>                <span class="p">}</span>
</span><span id="__span-35-560"><a id="__codelineno-35-560" name="__codelineno-35-560" href="#__codelineno-35-560"></a>            <span class="p">}</span>
</span><span id="__span-35-561"><a id="__codelineno-35-561" name="__codelineno-35-561" href="#__codelineno-35-561"></a>            <span class="s1">'Members'</span> <span class="p">{</span>
</span><span id="__span-35-562"><a id="__codelineno-35-562" name="__codelineno-35-562" href="#__codelineno-35-562"></a>                <span class="nb">Write-Host</span> <span class="s2">"Adding to Site Members group..."</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-563"><a id="__codelineno-35-563" name="__codelineno-35-563" href="#__codelineno-35-563"></a>                <span class="nv">$site</span> <span class="p">=</span> <span class="nb">Get-SPOSite</span> <span class="n">-Identity</span> <span class="nv">$SiteUrl</span>
</span><span id="__span-35-564"><a id="__codelineno-35-564" name="__codelineno-35-564" href="#__codelineno-35-564"></a>                <span class="nv">$groupName</span> <span class="p">=</span> <span class="s2">"</span><span class="p">$(</span><span class="nv">$site</span><span class="p">.</span><span class="n">Title</span><span class="p">)</span><span class="s2"> Members"</span>
</span><span id="__span-35-565"><a id="__codelineno-35-565" name="__codelineno-35-565" href="#__codelineno-35-565"></a>                <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-566"><a id="__codelineno-35-566" name="__codelineno-35-566" href="#__codelineno-35-566"></a>                    <span class="nb">Add-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-Group</span> <span class="nv">$groupName</span>
</span><span id="__span-35-567"><a id="__codelineno-35-567" name="__codelineno-35-567" href="#__codelineno-35-567"></a>                    <span class="nb">Write-Host</span> <span class="s2">"✅ $User added to Members group"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-568"><a id="__codelineno-35-568" name="__codelineno-35-568" href="#__codelineno-35-568"></a>                <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-569"><a id="__codelineno-35-569" name="__codelineno-35-569" href="#__codelineno-35-569"></a>                    <span class="c"># Fallback: try generic group name</span>
</span><span id="__span-35-570"><a id="__codelineno-35-570" name="__codelineno-35-570" href="#__codelineno-35-570"></a>                    <span class="nb">Add-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-Group</span> <span class="s2">"Members"</span>
</span><span id="__span-35-571"><a id="__codelineno-35-571" name="__codelineno-35-571" href="#__codelineno-35-571"></a>                    <span class="nb">Write-Host</span> <span class="s2">"✅ $User added to Members group"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-572"><a id="__codelineno-35-572" name="__codelineno-35-572" href="#__codelineno-35-572"></a>                <span class="p">}</span>
</span><span id="__span-35-573"><a id="__codelineno-35-573" name="__codelineno-35-573" href="#__codelineno-35-573"></a>            <span class="p">}</span>
</span><span id="__span-35-574"><a id="__codelineno-35-574" name="__codelineno-35-574" href="#__codelineno-35-574"></a>            <span class="s1">'Visitors'</span> <span class="p">{</span>
</span><span id="__span-35-575"><a id="__codelineno-35-575" name="__codelineno-35-575" href="#__codelineno-35-575"></a>                <span class="nb">Write-Host</span> <span class="s2">"Adding to Site Visitors group..."</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-576"><a id="__codelineno-35-576" name="__codelineno-35-576" href="#__codelineno-35-576"></a>                <span class="nv">$site</span> <span class="p">=</span> <span class="nb">Get-SPOSite</span> <span class="n">-Identity</span> <span class="nv">$SiteUrl</span>
</span><span id="__span-35-577"><a id="__codelineno-35-577" name="__codelineno-35-577" href="#__codelineno-35-577"></a>                <span class="nv">$groupName</span> <span class="p">=</span> <span class="s2">"</span><span class="p">$(</span><span class="nv">$site</span><span class="p">.</span><span class="n">Title</span><span class="p">)</span><span class="s2"> Visitors"</span>
</span><span id="__span-35-578"><a id="__codelineno-35-578" name="__codelineno-35-578" href="#__codelineno-35-578"></a>                <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-35-579"><a id="__codelineno-35-579" name="__codelineno-35-579" href="#__codelineno-35-579"></a>                    <span class="nb">Add-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-Group</span> <span class="nv">$groupName</span>
</span><span id="__span-35-580"><a id="__codelineno-35-580" name="__codelineno-35-580" href="#__codelineno-35-580"></a>                    <span class="nb">Write-Host</span> <span class="s2">"✅ $User added to Visitors group"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-581"><a id="__codelineno-35-581" name="__codelineno-35-581" href="#__codelineno-35-581"></a>                <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-582"><a id="__codelineno-35-582" name="__codelineno-35-582" href="#__codelineno-35-582"></a>                    <span class="c"># Fallback: try generic group name</span>
</span><span id="__span-35-583"><a id="__codelineno-35-583" name="__codelineno-35-583" href="#__codelineno-35-583"></a>                    <span class="nb">Add-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-Group</span> <span class="s2">"Visitors"</span>
</span><span id="__span-35-584"><a id="__codelineno-35-584" name="__codelineno-35-584" href="#__codelineno-35-584"></a>                    <span class="nb">Write-Host</span> <span class="s2">"✅ $User added to Visitors group"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-585"><a id="__codelineno-35-585" name="__codelineno-35-585" href="#__codelineno-35-585"></a>                <span class="p">}</span>
</span><span id="__span-35-586"><a id="__codelineno-35-586" name="__codelineno-35-586" href="#__codelineno-35-586"></a>            <span class="p">}</span>
</span><span id="__span-35-587"><a id="__codelineno-35-587" name="__codelineno-35-587" href="#__codelineno-35-587"></a>        <span class="p">}</span>
</span><span id="__span-35-588"><a id="__codelineno-35-588" name="__codelineno-35-588" href="#__codelineno-35-588"></a>
</span><span id="__span-35-589"><a id="__codelineno-35-589" name="__codelineno-35-589" href="#__codelineno-35-589"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Verifying user access..."</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-590"><a id="__codelineno-35-590" name="__codelineno-35-590" href="#__codelineno-35-590"></a>        <span class="nv">$userInfo</span> <span class="p">=</span> <span class="nb">Get-SPOUser</span> <span class="n">-Site</span> <span class="nv">$SiteUrl</span> <span class="n">-LoginName</span> <span class="nv">$User</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-35-591"><a id="__codelineno-35-591" name="__codelineno-35-591" href="#__codelineno-35-591"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$userInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-592"><a id="__codelineno-35-592" name="__codelineno-35-592" href="#__codelineno-35-592"></a>            <span class="nb">Write-Host</span> <span class="s2">"Display Name: </span><span class="p">$(</span><span class="nv">$userInfo</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-593"><a id="__codelineno-35-593" name="__codelineno-35-593" href="#__codelineno-35-593"></a>            <span class="nb">Write-Host</span> <span class="s2">"Login Name: </span><span class="p">$(</span><span class="nv">$userInfo</span><span class="p">.</span><span class="n">LoginName</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-594"><a id="__codelineno-35-594" name="__codelineno-35-594" href="#__codelineno-35-594"></a>            <span class="nb">Write-Host</span> <span class="s2">"Is Site Admin: </span><span class="p">$(</span><span class="nv">$userInfo</span><span class="p">.</span><span class="n">IsSiteAdmin</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-595"><a id="__codelineno-35-595" name="__codelineno-35-595" href="#__codelineno-35-595"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$userInfo</span><span class="p">.</span><span class="n">Groups</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-35-596"><a id="__codelineno-35-596" name="__codelineno-35-596" href="#__codelineno-35-596"></a>                <span class="nb">Write-Host</span> <span class="s2">"Groups: </span><span class="p">$(</span><span class="nv">$userInfo</span><span class="p">.</span><span class="n">Groups</span> <span class="n">-join</span> <span class="s1">', '</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-597"><a id="__codelineno-35-597" name="__codelineno-35-597" href="#__codelineno-35-597"></a>            <span class="p">}</span>
</span><span id="__span-35-598"><a id="__codelineno-35-598" name="__codelineno-35-598" href="#__codelineno-35-598"></a>        <span class="p">}</span>
</span><span id="__span-35-599"><a id="__codelineno-35-599" name="__codelineno-35-599" href="#__codelineno-35-599"></a>
</span><span id="__span-35-600"><a id="__codelineno-35-600" name="__codelineno-35-600" href="#__codelineno-35-600"></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-35-601"><a id="__codelineno-35-601" name="__codelineno-35-601" href="#__codelineno-35-601"></a>        <span class="nb">Write-Host</span> <span class="s2">"❌ Failed to add user: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">"</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-35-602"><a id="__codelineno-35-602" name="__codelineno-35-602" href="#__codelineno-35-602"></a>        <span class="nb">Write-Host</span> <span class="s2">"</span><span class="se">`n</span><span class="s2">Troubleshooting:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-603"><a id="__codelineno-35-603" name="__codelineno-35-603" href="#__codelineno-35-603"></a>        <span class="nb">Write-Host</span> <span class="s2">"  - Verify site URL is correct"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-604"><a id="__codelineno-35-604" name="__codelineno-35-604" href="#__codelineno-35-604"></a>        <span class="nb">Write-Host</span> <span class="s2">"  - Verify user email/UPN is correct"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-605"><a id="__codelineno-35-605" name="__codelineno-35-605" href="#__codelineno-35-605"></a>        <span class="nb">Write-Host</span> <span class="s2">"  - Ensure you have permissions to manage this site"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-606"><a id="__codelineno-35-606" name="__codelineno-35-606" href="#__codelineno-35-606"></a>        <span class="nb">Write-Host</span> <span class="s2">"  - For standard sites, use PnP PowerShell for more control"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-607"><a id="__codelineno-35-607" name="__codelineno-35-607" href="#__codelineno-35-607"></a>    <span class="p">}</span>
</span><span id="__span-35-608"><a id="__codelineno-35-608" name="__codelineno-35-608" href="#__codelineno-35-608"></a><span class="p">}</span>
</span><span id="__span-35-609"><a id="__codelineno-35-609" name="__codelineno-35-609" href="#__codelineno-35-609"></a>
</span><span id="__span-35-610"><a id="__codelineno-35-610" name="__codelineno-35-610" href="#__codelineno-35-610"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-611"><a id="__codelineno-35-611" name="__codelineno-35-611" href="#__codelineno-35-611"></a><span class="c"># ALIASES</span>
</span><span id="__span-35-612"><a id="__codelineno-35-612" name="__codelineno-35-612" href="#__codelineno-35-612"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-613"><a id="__codelineno-35-613" name="__codelineno-35-613" href="#__codelineno-35-613"></a>
</span><span id="__span-35-614"><a id="__codelineno-35-614" name="__codelineno-35-614" href="#__codelineno-35-614"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">exo</span> <span class="n">-Value</span> <span class="nb">Connect-EXO</span>
</span><span id="__span-35-615"><a id="__codelineno-35-615" name="__codelineno-35-615" href="#__codelineno-35-615"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">m365</span> <span class="n">-Value</span> <span class="nb">Connect-M365</span>
</span><span id="__span-35-616"><a id="__codelineno-35-616" name="__codelineno-35-616" href="#__codelineno-35-616"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">disco</span> <span class="n">-Value</span> <span class="nb">Disconnect-M365</span>
</span><span id="__span-35-617"><a id="__codelineno-35-617" name="__codelineno-35-617" href="#__codelineno-35-617"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">status</span> <span class="n">-Value</span> <span class="nb">Get-M365ConnectionStatus</span>
</span><span id="__span-35-618"><a id="__codelineno-35-618" name="__codelineno-35-618" href="#__codelineno-35-618"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">spo</span> <span class="n">-Value</span> <span class="nb">Connect-SPO</span>
</span><span id="__span-35-619"><a id="__codelineno-35-619" name="__codelineno-35-619" href="#__codelineno-35-619"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">scc</span> <span class="n">-Value</span> <span class="nb">Connect-SCC</span>
</span><span id="__span-35-620"><a id="__codelineno-35-620" name="__codelineno-35-620" href="#__codelineno-35-620"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">teams</span> <span class="n">-Value</span> <span class="nb">Connect-Teams</span>
</span><span id="__span-35-621"><a id="__codelineno-35-621" name="__codelineno-35-621" href="#__codelineno-35-621"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">azure</span> <span class="n">-Value</span> <span class="nb">Connect-Azure</span>
</span><span id="__span-35-622"><a id="__codelineno-35-622" name="__codelineno-35-622" href="#__codelineno-35-622"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">ce</span> <span class="n">-Value</span> <span class="n">Check-Email</span>
</span><span id="__span-35-623"><a id="__codelineno-35-623" name="__codelineno-35-623" href="#__codelineno-35-623"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">cmt</span> <span class="n">-Value</span> <span class="nb">Get-MailboxType</span>
</span><span id="__span-35-624"><a id="__codelineno-35-624" name="__codelineno-35-624" href="#__codelineno-35-624"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">cmp</span> <span class="n">-Value</span> <span class="n">Check-MailboxPerms</span>
</span><span id="__span-35-625"><a id="__codelineno-35-625" name="__codelineno-35-625" href="#__codelineno-35-625"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">cgm</span> <span class="n">-Value</span> <span class="n">Check-GroupMembers</span>
</span><span id="__span-35-626"><a id="__codelineno-35-626" name="__codelineno-35-626" href="#__codelineno-35-626"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">te</span> <span class="n">-Value</span> <span class="nb">Trace-Email</span>
</span><span id="__span-35-627"><a id="__codelineno-35-627" name="__codelineno-35-627" href="#__codelineno-35-627"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">tar</span> <span class="n">-Value</span> <span class="nb">Trace-AutoReply</span>
</span><span id="__span-35-628"><a id="__codelineno-35-628" name="__codelineno-35-628" href="#__codelineno-35-628"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">wc</span> <span class="n">-Value</span> <span class="nb">Get-WhoChanged</span>
</span><span id="__span-35-629"><a id="__codelineno-35-629" name="__codelineno-35-629" href="#__codelineno-35-629"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">cmd</span> <span class="n">-Value</span> <span class="n">Check-MobileDevices</span>
</span><span id="__span-35-630"><a id="__codelineno-35-630" name="__codelineno-35-630" href="#__codelineno-35-630"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">fum</span> <span class="n">-Value</span> <span class="nb">Find-UserMemberships</span>
</span><span id="__span-35-631"><a id="__codelineno-35-631" name="__codelineno-35-631" href="#__codelineno-35-631"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">fixloop</span> <span class="n">-Value</span> <span class="n">Fix-CalendarLoop</span>
</span><span id="__span-35-632"><a id="__codelineno-35-632" name="__codelineno-35-632" href="#__codelineno-35-632"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">grant</span> <span class="n">-Value</span> <span class="nb">Grant-TempAccess</span>
</span><span id="__span-35-633"><a id="__codelineno-35-633" name="__codelineno-35-633" href="#__codelineno-35-633"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">revoke</span> <span class="n">-Value</span> <span class="nb">Remove-TempAccess</span>
</span><span id="__span-35-634"><a id="__codelineno-35-634" name="__codelineno-35-634" href="#__codelineno-35-634"></a><span class="nb">Set-Alias</span> <span class="n">-Name</span> <span class="n">spouser</span> <span class="n">-Value</span> <span class="nb">Add-SPOSiteUser</span>
</span><span id="__span-35-635"><a id="__codelineno-35-635" name="__codelineno-35-635" href="#__codelineno-35-635"></a>
</span><span id="__span-35-636"><a id="__codelineno-35-636" name="__codelineno-35-636" href="#__codelineno-35-636"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-637"><a id="__codelineno-35-637" name="__codelineno-35-637" href="#__codelineno-35-637"></a><span class="c"># STARTUP MESSAGE</span>
</span><span id="__span-35-638"><a id="__codelineno-35-638" name="__codelineno-35-638" href="#__codelineno-35-638"></a><span class="c">#==============================================================================</span>
</span><span id="__span-35-639"><a id="__codelineno-35-639" name="__codelineno-35-639" href="#__codelineno-35-639"></a>
</span><span id="__span-35-640"><a id="__codelineno-35-640" name="__codelineno-35-640" href="#__codelineno-35-640"></a><span class="nb">Write-Host</span> <span class="s2">""</span>
</span><span id="__span-35-641"><a id="__codelineno-35-641" name="__codelineno-35-641" href="#__codelineno-35-641"></a><span class="nb">Write-Host</span> <span class="s2">"========================================"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-642"><a id="__codelineno-35-642" name="__codelineno-35-642" href="#__codelineno-35-642"></a><span class="nb">Write-Host</span> <span class="s2">"  M365 ADMIN TOOLS LOADED"</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-35-643"><a id="__codelineno-35-643" name="__codelineno-35-643" href="#__codelineno-35-643"></a><span class="nb">Write-Host</span> <span class="s2">"========================================"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-644"><a id="__codelineno-35-644" name="__codelineno-35-644" href="#__codelineno-35-644"></a>
</span><span id="__span-35-645"><a id="__codelineno-35-645" name="__codelineno-35-645" href="#__codelineno-35-645"></a><span class="nb">Get-M365ConnectionStatus</span>
</span><span id="__span-35-646"><a id="__codelineno-35-646" name="__codelineno-35-646" href="#__codelineno-35-646"></a>
</span><span id="__span-35-647"><a id="__codelineno-35-647" name="__codelineno-35-647" href="#__codelineno-35-647"></a><span class="nb">Write-Host</span> <span class="s2">"Connection commands:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-648"><a id="__codelineno-35-648" name="__codelineno-35-648" href="#__codelineno-35-648"></a><span class="nb">Write-Host</span> <span class="s2">"  m365   - Connect to Exchange Online + Graph"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-649"><a id="__codelineno-35-649" name="__codelineno-35-649" href="#__codelineno-35-649"></a><span class="nb">Write-Host</span> <span class="s2">"  exo    - Connect to Exchange Online only"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-650"><a id="__codelineno-35-650" name="__codelineno-35-650" href="#__codelineno-35-650"></a><span class="nb">Write-Host</span> <span class="s2">"  spo    - Connect to SharePoint Online"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-651"><a id="__codelineno-35-651" name="__codelineno-35-651" href="#__codelineno-35-651"></a><span class="nb">Write-Host</span> <span class="s2">"  scc    - Connect to Security &amp; Compliance"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-652"><a id="__codelineno-35-652" name="__codelineno-35-652" href="#__codelineno-35-652"></a><span class="nb">Write-Host</span> <span class="s2">"  teams  - Connect to Microsoft Teams"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-653"><a id="__codelineno-35-653" name="__codelineno-35-653" href="#__codelineno-35-653"></a><span class="nb">Write-Host</span> <span class="s2">"  disco  - Disconnect all"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-654"><a id="__codelineno-35-654" name="__codelineno-35-654" href="#__codelineno-35-654"></a><span class="nb">Write-Host</span> <span class="s2">"  status - Check connection status"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-655"><a id="__codelineno-35-655" name="__codelineno-35-655" href="#__codelineno-35-655"></a>
</span><span id="__span-35-656"><a id="__codelineno-35-656" name="__codelineno-35-656" href="#__codelineno-35-656"></a><span class="nb">Write-Host</span> <span class="s2">""</span>
</span><span id="__span-35-657"><a id="__codelineno-35-657" name="__codelineno-35-657" href="#__codelineno-35-657"></a><span class="nb">Write-Host</span> <span class="s2">"Quick commands:"</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-35-658"><a id="__codelineno-35-658" name="__codelineno-35-658" href="#__codelineno-35-658"></a><span class="nb">Write-Host</span> <span class="s2">"  ce [email]    - Check email address"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-659"><a id="__codelineno-35-659" name="__codelineno-35-659" href="#__codelineno-35-659"></a><span class="nb">Write-Host</span> <span class="s2">"  cmt [mbx]     - Check mailbox type/resource"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-660"><a id="__codelineno-35-660" name="__codelineno-35-660" href="#__codelineno-35-660"></a><span class="nb">Write-Host</span> <span class="s2">"  cmp [mbx]     - Check mailbox permissions"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-661"><a id="__codelineno-35-661" name="__codelineno-35-661" href="#__codelineno-35-661"></a><span class="nb">Write-Host</span> <span class="s2">"  cgm [group]   - Check group members"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-662"><a id="__codelineno-35-662" name="__codelineno-35-662" href="#__codelineno-35-662"></a><span class="nb">Write-Host</span> <span class="s2">"  te            - Trace email"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-663"><a id="__codelineno-35-663" name="__codelineno-35-663" href="#__codelineno-35-663"></a><span class="nb">Write-Host</span> <span class="s2">"  tar [user]    - Trace auto-replies"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-664"><a id="__codelineno-35-664" name="__codelineno-35-664" href="#__codelineno-35-664"></a><span class="nb">Write-Host</span> <span class="s2">"  wc [object]   - Who changed this?"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-665"><a id="__codelineno-35-665" name="__codelineno-35-665" href="#__codelineno-35-665"></a><span class="nb">Write-Host</span> <span class="s2">"  cmd [user]    - Check mobile devices"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-666"><a id="__codelineno-35-666" name="__codelineno-35-666" href="#__codelineno-35-666"></a><span class="nb">Write-Host</span> <span class="s2">"  fum [user]    - Find user memberships"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-667"><a id="__codelineno-35-667" name="__codelineno-35-667" href="#__codelineno-35-667"></a><span class="nb">Write-Host</span> <span class="s2">"  grant [mbx]   - Grant temporary mailbox access"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-668"><a id="__codelineno-35-668" name="__codelineno-35-668" href="#__codelineno-35-668"></a><span class="nb">Write-Host</span> <span class="s2">"  revoke [mbx]  - Remove temporary mailbox access"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-669"><a id="__codelineno-35-669" name="__codelineno-35-669" href="#__codelineno-35-669"></a><span class="nb">Write-Host</span> <span class="s2">"  fixloop [user] - Fix calendar loop"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-670"><a id="__codelineno-35-670" name="__codelineno-35-670" href="#__codelineno-35-670"></a><span class="nb">Write-Host</span> <span class="s2">"  spouser       - Add user to SPO site group"</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-35-671"><a id="__codelineno-35-671" name="__codelineno-35-671" href="#__codelineno-35-671"></a><span class="nb">Write-Host</span> <span class="s2">"========================================"</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-35-672"><a id="__codelineno-35-672" name="__codelineno-35-672" href="#__codelineno-35-672"></a><span class="nb">Write-Host</span> <span class="s2">""</span>
</span></code></pre></div>
<hr>
                    
                </article>
                
                
                
                <div class="bo-page-meta-bottom">
                    <div class="bo-page-meta-info">
                        
                        
                        <div class="bo-meta-item">
                            <svg class="bo-meta-icon" viewBox="0 0 16 16" width="14" height="14">
                                <path fill="currentColor" d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm7-3.25v2.992l2.028.812a.75.75 0 0 1-.557 1.392l-2.5-1A.751.751 0 0 1 7 8.25v-3.5a.75.75 0 0 1 1.5 0Z"></path>
                            </svg>
                            <span>Last updated: <time datetime="&lt;span class=" git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="December 6, 2025 00:46:25 UTC">December 6, 2025 00:46:25</time></span>"&gt;<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="December 6, 2025 00:46:25 UTC">December 6, 2025 00:46:25</span>
                        </div>
                        
                        
                        
                        
                        <div class="bo-meta-item">
                            <a href="https://github.com/rivcoit/MKDocs/edit/main/docs/Misc/PowerShellProfile.md" target="_blank" rel="noopener" class="bo-edit-link">
                                <svg class="bo-meta-icon" viewBox="0 0 16 16" width="14" height="14">
                                    <path fill="currentColor" d="M11.013 1.427a1.75 1.75 0 0 1 2.474 0l1.086 1.086a1.75 1.75 0 0 1 0 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 0 1-.927-.928l.929-3.25c.081-.286.235-.547.445-.758l8.61-8.61Zm.176 4.823L9.75 4.81l-6.286 6.287a.253.253 0 0 0-.064.108l-.558 1.953 1.953-.558a.253.253 0 0 0 .108-.064Zm1.238-3.763a.25.25 0 0 0-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 0 0 0-.354Z"></path>
                                </svg>
                                Edit this page
                            </a>
                        </div>
                        
                    </div>
                </div>
                
            </main>

            
            
            
            <aside class="bo-sidebar bo-sidebar-right">
                



<div class="bo-toc-main">
    <h4 class="bo-toc-title">On this page</h4>
    <ul class="bo-toc-list">
        
            
    <li class="bo-toc-item">
        <a href="#powershell-profile-m365-admin-tools" class="bo-toc-link">PowerShell Profile - M365 Admin Tools</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#overview" class="bo-toc-link">Overview</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#installation" class="bo-toc-link">Installation</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#step-1-locate-your-profile" class="bo-toc-link">Step 1: Locate Your Profile</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#step-2-create-profile-if-it-doesnt-exist" class="bo-toc-link">Step 2: Create Profile (if it doesn't exist)</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#step-3-edit-your-profile" class="bo-toc-link">Step 3: Edit Your Profile</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#step-4-copy-and-paste-the-script" class="bo-toc-link">Step 4: Copy and Paste the Script</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#step-5-save-and-reload" class="bo-toc-link">Step 5: Save and Reload</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#step-6-prerequisites" class="bo-toc-link">Step 6: Prerequisites</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#connection-commands" class="bo-toc-link">Connection Commands</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#exchange-online-only" class="bo-toc-link">Exchange Online Only</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#sharepoint-online" class="bo-toc-link">SharePoint Online</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#security-compliance-center" class="bo-toc-link">Security &amp; Compliance Center</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#microsoft-teams" class="bo-toc-link">Microsoft Teams</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#azure" class="bo-toc-link">Azure</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#full-m365-connection" class="bo-toc-link">Full M365 Connection</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#check-connection-status" class="bo-toc-link">Check Connection Status</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#disconnect-all-services" class="bo-toc-link">Disconnect All Services</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#quick-commands-email-mailbox" class="bo-toc-link">Quick Commands - Email &amp; Mailbox</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#check-email-address" class="bo-toc-link">Check Email Address</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#check-mailbox-type" class="bo-toc-link">Check Mailbox Type</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#check-mailbox-permissions" class="bo-toc-link">Check Mailbox Permissions</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#grant-temporary-mailbox-access" class="bo-toc-link">Grant Temporary Mailbox Access</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#remove-temporary-mailbox-access" class="bo-toc-link">Remove Temporary Mailbox Access</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#quick-commands-groups" class="bo-toc-link">Quick Commands - Groups</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#check-group-members" class="bo-toc-link">Check Group Members</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#add-user-to-group" class="bo-toc-link">Add User to Group</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#quick-commands-audit-troubleshooting" class="bo-toc-link">Quick Commands - Audit &amp; Troubleshooting</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#trace-email-delivery" class="bo-toc-link">Trace Email Delivery</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#trace-auto-replies" class="bo-toc-link">Trace Auto-Replies</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#who-changed-this" class="bo-toc-link">Who Changed This?</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#check-mobile-devices" class="bo-toc-link">Check Mobile Devices</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#fix-calendar-loop" class="bo-toc-link">Fix Calendar Loop</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#quick-commands-user-memberships" class="bo-toc-link">Quick Commands - User Memberships</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#find-user-group-memberships" class="bo-toc-link">Find User Group Memberships</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#quick-commands-sharepoint" class="bo-toc-link">Quick Commands - SharePoint</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#add-user-to-spo-site-group" class="bo-toc-link">Add User to SPO Site Group</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#startup-display" class="bo-toc-link">Startup Display</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#troubleshooting" class="bo-toc-link">Troubleshooting</a>
        
            <ul class="bo-toc-list is-child-list">
                
                    
    <li class="bo-toc-item">
        <a href="#profile-wont-run" class="bo-toc-link">Profile Won't Run</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#profile-loaded-but-commands-not-found" class="bo-toc-link">Profile Loaded But Commands Not Found</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#module-not-found-errors" class="bo-toc-link">Module Not Found Errors</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#connection-errors" class="bo-toc-link">Connection Errors</a>
        
    </li>
 
                
            </ul>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#notes" class="bo-toc-link">Notes</a>
        
    </li>
 
                
                    
    <li class="bo-toc-item">
        <a href="#complete-profile-script" class="bo-toc-link">Complete Profile Script</a>
        
    </li>
 
                
            </ul>
        
    </li>

        
    </ul>
</div>
            </aside>
            

        </div> 
    </div> 

    
    <footer class="bo-footer">
  <div class="bo-footer-content">
    
    <small>
      
        Copyright © 2025 RCIT
      
    </small>
    
    
    <small class="bo-footer-credits">
      Built with <a href="https://www.mkdocs.org/" target="_blank" rel="noopener">MkDocs</a>
    </small>
  </div>
</footer>

    
    
    <script src="../../assets/js/lunr.min.js"></script>
    
    <script src="../../assets/js/search-worker.js"></script>
    
    <script src="../../assets/js/search.js"></script>
    
    <script src="../../assets/js/enhancements.js"></script>
    
    <script src="../../assets/js/main.js"></script>
    
    <script src="../../search/main.js"></script>
    

    
    
        
        
<div class="bo-search-modal" id="search-modal" data-search-modal>
  <div class="bo-search-modal-container">
    <div class="bo-search-modal-header">
      <h3 class="bo-search-modal-title">Search</h3>
      <button class="bo-search-modal-close" data-search-close>×</button>
    </div>
    
    
    <input type="search" class="bo-search-modal-input" id="mkdocs-search-query" placeholder="Type to start searching..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    
    
    <div class="bo-search-results" id="mkdocs-search-results">
      
      <p>Type search query above.</p>
    </div>
  </div>
</div>
    


<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
</script></body></html>